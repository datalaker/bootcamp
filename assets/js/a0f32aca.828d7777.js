"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[55580],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>y});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),u=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},d=function(e){var t=u(e.components);return a.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},p=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,d=o(e,["components","mdxType","originalType","parentName"]),p=u(n),y=r,b=p["".concat(s,".").concat(y)]||p[y]||c[y]||i;return n?a.createElement(b,l(l({ref:t},d),{},{components:n})):a.createElement(b,l({ref:t},d))}));function y(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,l=new Array(i);l[0]=p;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o.mdxType="string"==typeof e?e:r,l[1]=o;for(var u=2;u<i;u++)l[u]=n[u];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}p.displayName="MDXCreateElement"},69477:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>c,frontMatter:()=>i,metadata:()=>o,toc:()=>u});var a=n(87462),r=(n(67294),n(3905));const i={},l="BigQuery Analysis",o={unversionedId:"storage/lab-bigquery-analysis/README",id:"storage/lab-bigquery-analysis/README",title:"BigQuery Analysis",description:"Objective",source:"@site/docs/02-storage/lab-bigquery-analysis/README.md",sourceDirName:"02-storage/lab-bigquery-analysis",slug:"/storage/lab-bigquery-analysis/",permalink:"/docs/storage/lab-bigquery-analysis/",draft:!1,tags:[],version:"current",lastUpdatedBy:"sparsh",lastUpdatedAt:1681047270,formattedLastUpdatedAt:"Apr 9, 2023",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Configuring and Securing Azure SQL Database",permalink:"/docs/storage/lab-azure-sql-securing-databases/"},next:{title:"BigQuery Commandline",permalink:"/docs/storage/lab-bigquery-commandline/"}},s={},u=[{value:"Objective",id:"objective",level:2},{value:"Explore bicycle rental data",id:"explore-bicycle-rental-data",level:3},{value:"Explore the weather dataset",id:"explore-the-weather-dataset",level:3},{value:"Find correlation between rain and bicycle rentals",id:"find-correlation-between-rain-and-bicycle-rentals",level:3},{value:"Summary",id:"summary",level:3}],d={toc:u};function c(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"bigquery-analysis"},"BigQuery Analysis"),(0,r.kt)("h2",{id:"objective"},"Objective"),(0,r.kt)("p",null,"Using BigQuery to do Analysis"),(0,r.kt)("p",null,"In this lab you analyze 2 different public datasets, run queries on them, separately and then combined, to derive interesting insights."),(0,r.kt)("p",null,"In this lab, you will:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Carry out interactive queries on the BigQuery console."),(0,r.kt)("li",{parentName:"ul"},"Combine and run analytics on multiple datasets.")),(0,r.kt)("p",null,"This lab uses two public datasets in BigQuery: weather data from the US National Oceanic and Atmospheric Administration (NOAA), and bicycle rental data from New York City."),(0,r.kt)("p",null,"You will encounter, for the first time, several aspects of Google Cloud Platform that are of great benefit to scientists:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Serverless.\xa0No need to download data to your machine in order to work with it - the dataset will remain on the cloud."),(0,r.kt)("li",{parentName:"ol"},"Ease of use.\xa0Run ad-hoc SQL queries on your dataset without having to prepare the data, like indexes, beforehand. This is invaluable for data exploration."),(0,r.kt)("li",{parentName:"ol"},"Scale.\xa0Carry out data exploration on extremely large datasets interactively. You don't need to sample the data in order to work with it in a timely manner."),(0,r.kt)("li",{parentName:"ol"},"Shareability. You will be able to run queries on data from different datasets without any issues. BigQuery is a convenient way to share datasets. Of course, you can also keep your data private, or share them only with specific persons -- not all data need to be public.")),(0,r.kt)("p",null,"The end-result is that you will find if there are lesser bike rentals on rainy days."),(0,r.kt)("h3",{id:"explore-bicycle-rental-data"},"Explore bicycle rental data"),(0,r.kt)("p",null,"Click\xa0Compose New Query\xa0and enter the following:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT\n  MIN(start_station_name) AS start_station_name,\n  MIN(end_station_name) AS end_station_name,\n  APPROX_QUANTILES(tripduration, 10)[OFFSET (5)] AS typical_duration,\n  COUNT(tripduration) AS num_trips\nFROM\n  `bigquery-public-data.new_york_citibike.citibike_trips`\nWHERE\n  start_station_id != end_station_id\nGROUP BY\n  start_station_id,\n  end_station_id\nORDER BY\n  num_trips DESC\nLIMIT\n  10\n")),(0,r.kt)("p",null,"Click\xa0Run. Look at the result and try to determine what this query does? (Hint: typical duration for the 10 most common one-way rentals)"),(0,r.kt)("p",null,"Next, run the below to find another interesting fact: total distance traveled by each bicycle in the dataset. Note that the query limits the results to only top 5."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"WITH\n  trip_distance AS (\nSELECT\n  bikeid,\n  ST_Distance(ST_GeogPoint(s.longitude,\n      s.latitude),\n    ST_GeogPoint(e.longitude,\n      e.latitude)) AS distance\nFROM\n  `bigquery-public-data.new_york_citibike.citibike_trips`,\n  `bigquery-public-data.new_york_citibike.citibike_stations` as s,\n  `bigquery-public-data.new_york_citibike.citibike_stations` as e\nWHERE\n  start_station_id = s.station_id\n  AND end_station_id = e.station_id )\nSELECT\n  bikeid,\n  SUM(distance)/1000 AS total_distance\nFROM\n  trip_distance\nGROUP BY\n  bikeid\nORDER BY\n  total_distance DESC\nLIMIT\n  5\n")),(0,r.kt)("p",null,"Note:\xa0For this query, we also used the other table in the dataset called\xa0citibike_stations\xa0to get bicycle station information."),(0,r.kt)("h3",{id:"explore-the-weather-dataset"},"Explore the weather dataset"),(0,r.kt)("p",null,"Click\xa0Compose New Query\xa0and enter the following:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT\n  wx.date,\n  wx.value/10.0 AS prcp\nFROM\n  `bigquery-public-data.ghcn_d.ghcnd_2015` AS wx\nWHERE\n  id = 'USW00094728'\n  AND qflag IS NULL\n  AND element = 'PRCP'\nORDER BY\n  wx.date\n")),(0,r.kt)("p",null,"This query will return rainfall (in mm) for all days in 2015 from a weather station in New York whose id is provided in the query (the station corresponds to NEW YORK CNTRL PK TWR)."),(0,r.kt)("h3",{id:"find-correlation-between-rain-and-bicycle-rentals"},"Find correlation between rain and bicycle rentals"),(0,r.kt)("p",null,"How about joining the bicycle rentals data against weather data to learn whether there are fewer bicycle rentals on rainy days?"),(0,r.kt)("p",null,"Click\xa0Compose New Query\xa0and enter the following:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"WITH bicycle_rentals AS (\n  SELECT\n    COUNT(starttime) as num_trips,\n    EXTRACT(DATE from starttime) as trip_date\n  FROM `bigquery-public-data.new_york_citibike.citibike_trips`\n  GROUP BY trip_date\n),\nrainy_days AS\n(\nSELECT\n  date,\n  (MAX(prcp) > 5) AS rainy\nFROM (\n  SELECT\n    wx.date AS date,\n    IF (wx.element = 'PRCP', wx.value/10, NULL) AS prcp\n  FROM\n    `bigquery-public-data.ghcn_d.ghcnd_2015` AS wx\n  WHERE\n    wx.id = 'USW00094728'\n)\nGROUP BY\n  date\n)\nSELECT\n  ROUND(AVG(bk.num_trips)) AS num_trips,\n  wx.rainy\nFROM bicycle_rentals AS bk\nJOIN rainy_days AS wx\nON wx.date = bk.trip_date\nGROUP BY wx.rainy\n")),(0,r.kt)("p",null,"Now you can see the results of joining the bicycle rental dataset with a weather dataset that comes from a completely different source."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/62965911/214003164-88638d50-958d-4036-bfb9-e108abc32886.png",alt:null})),(0,r.kt)("p",null,"Running the query yields that, yes, New Yorkers ride the bicycle 47% fewer times when it rains."),(0,r.kt)("h3",{id:"summary"},"Summary"),(0,r.kt)("p",null,"In this lab you did ad-hoc queries on two datasets. You were able to query the data without setting up any clusters, creating any indexes, etc. You were also able to mash up the two datasets and get some interesting insights. All without ever leaving your browser!"),(0,r.kt)("p",null,"Congratulations!"),(0,r.kt)("p",null,"You learned how to run some very interesting queries on BigQuery!"))}c.isMDXComponent=!0}}]);