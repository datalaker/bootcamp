"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[76623],{3905:(e,t,r)=>{r.d(t,{Zo:()=>p,kt:()=>m});var o=r(67294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function n(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t){if(null==e)return{};var r,o,a=function(e,t){if(null==e)return{};var r,o,a={},n=Object.keys(e);for(o=0;o<n.length;o++)r=n[o],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(o=0;o<n.length;o++)r=n[o],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var s=o.createContext({}),c=function(e){var t=o.useContext(s),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},p=function(e){var t=c(e.components);return o.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},d=o.forwardRef((function(e,t){var r=e.components,a=e.mdxType,n=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=c(r),m=a,h=d["".concat(s,".").concat(m)]||d[m]||u[m]||n;return r?o.createElement(h,i(i({ref:t},p),{},{components:r})):o.createElement(h,i({ref:t},p))}));function m(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var n=r.length,i=new Array(n);i[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var c=2;c<n;c++)i[c]=r[c];return o.createElement.apply(null,i)}return o.createElement.apply(null,r)}d.displayName="MDXCreateElement"},43294:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>u,frontMatter:()=>n,metadata:()=>l,toc:()=>c});var o=r(87462),a=(r(67294),r(3905));const n={},i="Deploy Docker in ECS",l={unversionedId:"devops/containers/lab-deploy-simple-docker-ecs/README",id:"devops/containers/lab-deploy-simple-docker-ecs/README",title:"Deploy Docker in ECS",description:"Create a Docker image",source:"@site/docs/07-devops/containers/lab-deploy-simple-docker-ecs/README.md",sourceDirName:"07-devops/containers/lab-deploy-simple-docker-ecs",slug:"/devops/containers/lab-deploy-simple-docker-ecs/",permalink:"/docs/devops/containers/lab-deploy-simple-docker-ecs/",draft:!1,tags:[],version:"current",lastUpdatedBy:"sparsh",lastUpdatedAt:1681047270,formattedLastUpdatedAt:"Apr 9, 2023",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"ETL Docker",permalink:"/docs/devops/containers/lab-assignment-etl-docker/"},next:{title:"Deploying a NodeJS app in Kubernetes",permalink:"/docs/devops/containers/lab-kubernetes-kubia-app/"}},s={},c=[{value:"Create a Docker image",id:"create-a-docker-image",level:2},{value:"Create Dockerfile",id:"create-dockerfile",level:3},{value:"Build the Docker image",id:"build-the-docker-image",level:3},{value:"Optional - Verify",id:"optional---verify",level:3},{value:"Optional - Run",id:"optional---run",level:3},{value:"Push your image to Amazon Elastic Container Registry",id:"push-your-image-to-amazon-elastic-container-registry",level:2},{value:"Create an Amazon ECR repository",id:"create-an-amazon-ecr-repository",level:3},{value:"Tag the image",id:"tag-the-image",level:3},{value:"Authenticate",id:"authenticate",level:3},{value:"Push",id:"push",level:3},{value:"Clean up",id:"clean-up",level:2}],p={toc:c};function u(e){let{components:t,...r}=e;return(0,a.kt)("wrapper",(0,o.Z)({},p,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"deploy-docker-in-ecs"},"Deploy Docker in ECS"),(0,a.kt)("h2",{id:"create-a-docker-image"},"Create a Docker image"),(0,a.kt)("p",null,"Amazon ECS task definitions use Docker images to launch containers on the container instances in your clusters. In this section, you create a Docker image of a simple web application, and then push the image to the Amazon ECR container registry so you can use it in an Amazon ECS task definition."),(0,a.kt)("h3",{id:"create-dockerfile"},"Create Dockerfile"),(0,a.kt)("p",null,'This Dockerfile uses the Ubuntu 18.04 image. The RUN instructions update the package caches, install some software packages for the web server, and then write the "Hello World!" content to the web server\'s document root. The EXPOSE instruction exposes port 80 on the container, and the CMD instruction starts the web server.'),(0,a.kt)("h3",{id:"build-the-docker-image"},"Build the Docker image"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"docker build -t hello-world .\n")),(0,a.kt)("h3",{id:"optional---verify"},"Optional - Verify"),(0,a.kt)("p",null,"Run docker images to verify that the image was created correctly:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"docker images --filter reference=hello-world\n")),(0,a.kt)("h3",{id:"optional---run"},"Optional - Run"),(0,a.kt)("p",null,"Run the newly built image. The -p 80:80 option maps the exposed port 80 on the container to port 80 on the host system."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"docker run -t -i -p 80:80 hello-world\n")),(0,a.kt)("h2",{id:"push-your-image-to-amazon-elastic-container-registry"},"Push your image to Amazon Elastic Container Registry"),(0,a.kt)("p",null,"Amazon ECR is a managed AWS Docker registry service. You can use the Docker CLI to push, pull, and manage images in your Amazon ECR repositories."),(0,a.kt)("h3",{id:"create-an-amazon-ecr-repository"},"Create an Amazon ECR repository"),(0,a.kt)("p",null,"Create an Amazon ECR repository to store your hello-world image. Note the repositoryUri in the output."),(0,a.kt)("p",null,"Substitute region, with your AWS Region, for example, us-east-1."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"aws ecr create-repository --repository-name hello-repository --region region\n")),(0,a.kt)("h3",{id:"tag-the-image"},"Tag the image"),(0,a.kt)("p",null,"Tag the hello-world image with the repositoryUri value from the previous step."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"docker tag hello-world aws_account_id.dkr.ecr.region.amazonaws.com/hello-repo\ndocker tag hello-world 684199068947.dkr.ecr.region.amazonaws.com/hello-repo\n")),(0,a.kt)("h3",{id:"authenticate"},"Authenticate"),(0,a.kt)("p",null,"Run the aws ecr get-login-password command. Specify the registry URI you want to authenticate to."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"docker login -u AWS -p $(aws ecr get-login-password --region REGION) aws_account_id.dkr.ecr.REGION.amazonaws.com\n")),(0,a.kt)("h3",{id:"push"},"Push"),(0,a.kt)("p",null,"Push the image to Amazon ECR with the repositoryUri value from the earlier step."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"docker push aws_account_id.dkr.ecr.region.amazonaws.com/hello-repo\n")),(0,a.kt)("h2",{id:"clean-up"},"Clean up"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"aws ecr delete-repository --repository-name hello-repo --region region --force\n")))}u.isMDXComponent=!0}}]);