"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[50189],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>d});var a=n(67294);function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,s=function(e,t){if(null==e)return{};var n,a,s={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(s[n]=e[n]);return s}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}var o=a.createContext({}),u=function(e){var t=a.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=u(e.components);return a.createElement(o.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},p=a.forwardRef((function(e,t){var n=e.components,s=e.mdxType,r=e.originalType,o=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),p=u(n),d=s,y=p["".concat(o,".").concat(d)]||p[d]||m[d]||r;return n?a.createElement(y,i(i({ref:t},c),{},{components:n})):a.createElement(y,i({ref:t},c))}));function d(e,t){var n=arguments,s=t&&t.mdxType;if("string"==typeof e||s){var r=n.length,i=new Array(r);i[0]=p;var l={};for(var o in t)hasOwnProperty.call(t,o)&&(l[o]=t[o]);l.originalType=e,l.mdxType="string"==typeof e?e:s,i[1]=l;for(var u=2;u<r;u++)i[u]=n[u];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}p.displayName="MDXCreateElement"},68513:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>i,default:()=>m,frontMatter:()=>r,metadata:()=>l,toc:()=>u});var a=n(87462),s=(n(67294),n(3905));const r={},i="Working with Cassandra and CLI",l={unversionedId:"storage/lab-getting-started-with-cassandra/cassandra-cli",id:"storage/lab-getting-started-with-cassandra/cassandra-cli",title:"Working with Cassandra and CLI",description:"Cassandra and Shell",source:"@site/docs/02-storage/lab-getting-started-with-cassandra/cassandra-cli.md",sourceDirName:"02-storage/lab-getting-started-with-cassandra",slug:"/storage/lab-getting-started-with-cassandra/cassandra-cli",permalink:"/docs/storage/lab-getting-started-with-cassandra/cassandra-cli",draft:!1,tags:[],version:"current",lastUpdatedBy:"sparsh",lastUpdatedAt:1681047270,formattedLastUpdatedAt:"Apr 9, 2023",frontMatter:{}},o={},u=[{value:"Cassandra and Shell",id:"cassandra-and-shell",level:2},{value:"Run server",id:"run-server",level:3},{value:"Activate CQL shell",id:"activate-cql-shell",level:3},{value:"Create a keyspace",id:"create-a-keyspace",level:3},{value:"Set a working keyspace",id:"set-a-working-keyspace",level:3},{value:"Create a table",id:"create-a-table",level:3},{value:"Insert a row",id:"insert-a-row",level:3},{value:"Retrieve a row",id:"retrieve-a-row",level:3},{value:"Update a row",id:"update-a-row",level:3},{value:"Delete a row",id:"delete-a-row",level:3},{value:"Test Your Understanding",id:"test-your-understanding",level:3},{value:"CQL Shell Commands",id:"cql-shell-commands",level:2},{value:"Learning CQL Data Types",id:"learning-cql-data-types",level:2},{value:"Cassandra and Python",id:"cassandra-and-python",level:2},{value:"Installation",id:"installation",level:3},{value:"Creating a Table with Apache Cassandra",id:"creating-a-table-with-apache-cassandra",level:3},{value:"Three Queries Three Tables",id:"three-queries-three-tables",level:2},{value:"Using the WHERE Clause",id:"using-the-where-clause",level:2},{value:"Amazon Keyspaces for Apache Cassandra",id:"amazon-keyspaces-for-apache-cassandra",level:2},{value:"First Keyspace",id:"first-keyspace",level:3},{value:"Connect via Python/CQLSH client",id:"connect-via-pythoncqlsh-client",level:3},{value:"Loading data into Amazon Keyspaces using cqlsh",id:"loading-data-into-amazon-keyspaces-using-cqlsh",level:3},{value:"Using NoSQL Workbench with Amazon Keyspaces",id:"using-nosql-workbench-with-amazon-keyspaces",level:3}],c={toc:u};function m(e){let{components:t,...r}=e;return(0,s.kt)("wrapper",(0,a.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("h1",{id:"working-with-cassandra-and-cli"},"Working with Cassandra and CLI"),(0,s.kt)("h2",{id:"cassandra-and-shell"},"Cassandra and Shell"),(0,s.kt)("h3",{id:"run-server"},"Run server"),(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},"cassandra -f")),(0,s.kt)("h3",{id:"activate-cql-shell"},"Activate CQL shell"),(0,s.kt)("p",null,"Run ",(0,s.kt)("inlineCode",{parentName:"p"},"cqlsh")),(0,s.kt)("h3",{id:"create-a-keyspace"},"Create a keyspace"),(0,s.kt)("p",null,'A keyspace is a namespace for a set of tables sharing a data replication strategy and some options. It is conceptually similar to a "database" in a relational database management system.'),(0,s.kt)("p",null,"Create the keyspace:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE KEYSPACE killr_video\nWITH replication = {\n  'class': 'SimpleStrategy', \n  'replication_factor': 1 }; \n")),(0,s.kt)("p",null,"Our keyspace name is killr_video. Any data in this keyspace will be replicated using replication strategy SimpleStrategy and replication factor 1 . In production, however, we strongly recommend multiple datacenters and at least three replicas per datacenter for higher availability."),(0,s.kt)("h3",{id:"set-a-working-keyspace"},"Set a working keyspace"),(0,s.kt)("p",null,"Many CQL statements work with tables, indexes and other objects defined within a specific keyspace. For example, to refer to a table, we have to either use a fully-qualified name consisting of a keyspace name and a table name, or set a working keyspace and simply refer to the table by its name. For convenience, we go with the second option."),(0,s.kt)("p",null,"Set the current working keyspace:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sql"},"USE killr_video;\n")),(0,s.kt)("h3",{id:"create-a-table"},"Create a table"),(0,s.kt)("p",null,"A Cassandra table has named columns with data types, rows with values, and a primary key to uniquely identify each row. As an example, let's create table users with four columns and primary key email ."),(0,s.kt)("p",null,"Create the table:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE TABLE users (\n  email TEXT PRIMARY KEY,\n  name TEXT,\n  age INT,\n  date_joined DATE\n);\n")),(0,s.kt)("p",null,"Example:"),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(97218).Z,width:"1294",height:"501"})),(0,s.kt)("h3",{id:"insert-a-row"},"Insert a row"),(0,s.kt)("p",null,"Add the row into our table using the CQL INSERT statement:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sql"},"INSERT INTO users (email, name, age, date_joined) \nVALUES ('joe@datastax.com', 'Joe', 25, '2020-01-01');\n")),(0,s.kt)("p",null,"Insert another row into the table:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sql"},"INSERT INTO users (email, name, age, date_joined) \nVALUES ('jen@datastax.com', 'Jen', 27, '2020-01-01');\n")),(0,s.kt)("h3",{id:"retrieve-a-row"},"Retrieve a row"),(0,s.kt)("p",null,"Now, retrieve the row using the CQL SELECT statement:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT * FROM users\nWHERE email = 'joe@datastax.com';\n")),(0,s.kt)("p",null,"Retrieve a different row from the table:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT * FROM users\nWHERE email = 'jen@datastax.com';\n")),(0,s.kt)("h3",{id:"update-a-row"},"Update a row"),(0,s.kt)("p",null,"Next, update the row using the CQL UPDATE statement:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sql"},"UPDATE users SET name = 'Joseph' \nWHERE email = 'joe@datastax.com';\n\nSELECT * FROM users;\n")),(0,s.kt)("p",null,"Update another row in the table:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sql"},"UPDATE users SET name = 'Jennifer' \nWHERE email = 'jen@datastax.com';\n\nSELECT * FROM users;\n")),(0,s.kt)("h3",{id:"delete-a-row"},"Delete a row"),(0,s.kt)("p",null,"Finally, delete the row using the CQL DELETE statement:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sql"},"DELETE FROM users \nWHERE email = 'joe@datastax.com';\n\nSELECT * FROM users;\n")),(0,s.kt)("p",null,"Delete another row from the table:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sql"},"DELETE FROM users \nWHERE email = 'jen@datastax.com';\n\nSELECT * FROM users;\n")),(0,s.kt)("h3",{id:"test-your-understanding"},"Test Your Understanding"),(0,s.kt)("p",null,"Here is a short quiz for you."),(0,s.kt)("p",null,"Q1. Which CQL statement can be used to add rows into a table?"),(0,s.kt)("ul",{className:"contains-task-list"},(0,s.kt)("li",{parentName:"ul",className:"task-list-item"},(0,s.kt)("input",{parentName:"li",type:"checkbox",checked:!1,disabled:!0})," ","A. SELECT"),(0,s.kt)("li",{parentName:"ul",className:"task-list-item"},(0,s.kt)("input",{parentName:"li",type:"checkbox",checked:!1,disabled:!0})," ","B. DELETE"),(0,s.kt)("li",{parentName:"ul",className:"task-list-item"},(0,s.kt)("input",{parentName:"li",type:"checkbox",checked:!1,disabled:!0})," ","C. INSERT")),(0,s.kt)("details",null,(0,s.kt)("summary",null,"Show me the Answer! "),"C"),(0,s.kt)("p",null,"Q2. Which CQL statement can be used to retrieve rows from a table?"),(0,s.kt)("ul",{className:"contains-task-list"},(0,s.kt)("li",{parentName:"ul",className:"task-list-item"},(0,s.kt)("input",{parentName:"li",type:"checkbox",checked:!1,disabled:!0})," ","A. SELECT"),(0,s.kt)("li",{parentName:"ul",className:"task-list-item"},(0,s.kt)("input",{parentName:"li",type:"checkbox",checked:!1,disabled:!0})," ","B. DELETE"),(0,s.kt)("li",{parentName:"ul",className:"task-list-item"},(0,s.kt)("input",{parentName:"li",type:"checkbox",checked:!1,disabled:!0})," ","C. INSERT")),(0,s.kt)("details",null,(0,s.kt)("summary",null,"Show me the Answer! "),"A"),(0,s.kt)("p",null,"Q3. Which CQL statement can be used to remove rows from a table?"),(0,s.kt)("ul",{className:"contains-task-list"},(0,s.kt)("li",{parentName:"ul",className:"task-list-item"},(0,s.kt)("input",{parentName:"li",type:"checkbox",checked:!1,disabled:!0})," ","A. SELECT"),(0,s.kt)("li",{parentName:"ul",className:"task-list-item"},(0,s.kt)("input",{parentName:"li",type:"checkbox",checked:!1,disabled:!0})," ","B. DELETE"),(0,s.kt)("li",{parentName:"ul",className:"task-list-item"},(0,s.kt)("input",{parentName:"li",type:"checkbox",checked:!1,disabled:!0})," ","C. INSERT")),(0,s.kt)("details",null,(0,s.kt)("summary",null,"Show me the Answer! "),"B"),(0,s.kt)("h2",{id:"cql-shell-commands"},"CQL Shell Commands"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sh"},"# Start the CQL shell\ncqlsh\n\n# To get help for cqlsh, type HELP or ? to see the list of available commands:\nHELP\n\n# To learn about the current cluster you\u2019re working in, type:\nDESCRIBE CLUSTER;\n\n# To see which keyspaces are available in the cluster, issue the command below.\n# What are these keyspaces for?\nDESCRIBE KEYSPACES;\n\n# Learn the client, server, and protocol versions in use\nSHOW VERSION;\n\n# View the default paging settings that will be used on reads\nPAGING;\n\n# View the default consistency level that will be used on all queries\nCONSISTENCY\n\n# View the default tracing options\nTRACING\n\n# Create your own keyspace. Try using tab completion as you enter this command\nCREATE KEYSPACE my_keyspace WITH replication = {'class': 'SimpleStrategy', 'replication_factor': 1};\n\n# Describe the keyspace you just created.\n# What additional information do you notice?\nDESCRIBE KEYSPACE my_keyspace;\n\n# Use the keyspace so you don't have to enter it on every data manipulation\n# Note how the prompt changes after you do this\nUSE my_keyspace;\n\n# Create a simple table\n# What other syntax could you use to designate a single column primary key?\nCREATE TABLE user ( first_name text, last_name text, PRIMARY KEY (first_name));\n\n# Describe the table you just created\n# What additional information do you notice?\nDESCRIBE TABLE user;\n\n# Write some data\nINSERT INTO user (first_name, last_name) VALUES ('Bill', 'Nguyen');\n\n# See how many rows have been written into this table\n# Warning - row scans are expensive operations on large tables\nSELECT COUNT (*) FROM user;\n\n# Read the data we just wrote\nSELECT * FROM user WHERE first_name='Bill';\n\n# Remove a non-primary key column\nDELETE last_name FROM USER WHERE first_name='Bill';\n\n# Check to see the value was removed\nSELECT * FROM user WHERE first_name='Bill';\n\n# Delete an entire row\nDELETE FROM USER WHERE first_name='Bill';\n\n# Check to make sure it was removed\nSELECT * FROM user WHERE first_name='Bill';\n\n# Add a column to the table\nALTER TABLE user ADD title text;\n\n# Check to see that the column was added\nDESCRIBE TABLE user;\n\n# Write a couple of rows, populate different columns for each, and view the results:\nINSERT INTO user (first_name, last_name, title) VALUES ('Bill', 'Nguyen', 'Mr.');\nINSERT INTO user (first_name, last_name) VALUES ('Mary', 'Rodriguez');\nSELECT * FROM user;\n\n# View the timestamps generated for previous writes\nSELECT first_name, last_name, writetime(last_name) FROM user;\n\n# Note that we\u2019re not allowed to ask for the timestamp on primary key columns:\nSELECT WRITETIME(first_name) FROM user;\n\n# Set the timestamp on a write\n# Note, you will probably want to change this value to be closer to your current time\n#   (similar to timestamp from previous set)\nUPDATE user USING TIMESTAMP 1434373756626000 SET last_name = 'Boateng' WHERE first_name = 'Mary' ;\n\n# Verify the timestamp used\nSELECT first_name, last_name, WRITETIME(last_name) FROM user WHERE first_name = 'Mary';\n\n# View the time to live value for a column\nSELECT first_name, last_name, TTL(last_name) FROM user WHERE first_name = 'Mary';\n\n# Set the TTL on the  last name column to one hour\nUPDATE user USING TTL 3600 SET last_name = 'McDonald' WHERE first_name = 'Mary' ;\n\n# View the resulting TTL\n# Note that it will already be counting down\nSELECT first_name, last_name, TTL(last_name) FROM user WHERE first_name = 'Mary';\n\n# Empty the contents of the table\nTRUNCATE user;\n\n# Show that the table is empty\nSELECT * FROM user;\n\n# Remove the entire table\nDROP TABLE user;\n\n# Clear the screen of output from previous commands\nCLEAR\n\n# Exit cqlsh\nEXIT\n")),(0,s.kt)("h2",{id:"learning-cql-data-types"},"Learning CQL Data Types"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sh"},"# Continue using the keyspace and table from cqlsh_intro.cql\n# Note use of IF NOT EXISTS syntax to avoid errors if already present\nCREATE KEYSPACE IF NOT EXISTS my_keyspace WITH replication = {'class': 'SimpleStrategy', 'replication_factor': 1} ;\nUSE my_keyspace;\nCREATE TABLE IF NOT EXISTS user ( first_name text, last_name text, title text, PRIMARY KEY (first_name));\n\n# Write a couple of rows, but only if they don't exist already\nINSERT INTO user (first_name, last_name, title) VALUES ('Bill', 'Nguyen', 'Mr.') IF NOT EXISTS;\nINSERT INTO user (first_name, last_name) VALUES ('Mary', 'Rodriguez') IF NOT EXISTS;\n\n#\n# UUID examples\n#\n\n# Add a unique identifier using a uuid\nALTER TABLE user ADD id uuid;\n\n# Allow Cassandra to auto-assign a uuid\nUPDATE user SET id = uuid() WHERE first_name = 'Mary';\n\n# View the id that was set\nSELECT first_name, id FROM user WHERE first_name = 'Mary';\n\n#\n# Set examples\n#\n\n# Add a set to contain email addresses\nALTER TABLE user ADD emails set<text>;\n\n# Add an email address and check that it was added successfully\nUPDATE user SET emails = { 'mary@example.com' } WHERE first_name = 'Mary';\nSELECT emails FROM user WHERE first_name = 'Mary';\n\n# Add another email address using concatenation\nUPDATE user SET emails = emails + {'mary.mcdonald.AZ@gmail.com' } WHERE first_name = 'Mary';\nSELECT emails FROM user WHERE first_name = 'Mary';\n\n#\n# List examples\n#\n\n# Modify the user table to add a list of phone numbers\nALTER TABLE user ADD phone_numbers list<text>;\n\n# Add a phone number for Mary and check that it was added successfully\nUPDATE user SET phone_numbers = [ '1-800-999-9999' ] WHERE first_name = 'Mary';\nSELECT phone_numbers FROM user WHERE first_name = 'Mary';\n\n# Add a second number by appending it:\nUPDATE user SET phone_numbers = phone_numbers + [ '480-111-1111' ] WHERE first_name = 'Mary';\nSELECT phone_numbers FROM user WHERE first_name = 'Mary';\n\n# Replace an individual item in the list referenced by its index\nUPDATE user SET phone_numbers[1] = '480-111-1111' WHERE first_name = 'Mary';\n\n# Use the subtraction operator to remove a list item matching a specified value\nUPDATE user SET phone_numbers = phone_numbers - [ '480-111-1111' ] WHERE first_name = 'Mary';\n\n# Delete a specific item directly using its index\nDELETE phone_numbers[0] from user WHERE first_name = 'Mary';\n\n#\n# Map examples\n#\n\n# Add a map attribute to store information about user logins (timed in seconds) keyed by a timestamp (timeuuid)\nALTER TABLE user ADD login_sessions map<timeuuid, int>;\n\n# Add a couple of login sessions for Mary and see the results\n# Use the now() function to allow Cassandra to set the timestamp\nUPDATE user SET login_sessions = { now(): 13, now(): 18} WHERE first_name = 'Mary';\nSELECT login_sessions FROM user WHERE first_name = 'Mary';\n\n#\n# User Defined Type (UDT) examples\n#\n\n# Create a UDT for address information\nCREATE TYPE address (street text, city text, state text, zip_code int);\n\n# Can we use this UDT in a map?\nALTER TABLE user ADD addresses map<text, address>;\n\n# Freeze the UDT so we can use it in a map\n# freezing means we cannot access individual fields of the UDT but must select or insert the entire object at once\nALTER TABLE user ADD addresses map<text, frozen<address>>;\n\n# Add a home address for Mary\nUPDATE user SET addresses = addresses +  {'home': { street: '7712 E. Broadway', city: 'Tucson',\n  state: 'AZ', zip_code: 85715} } WHERE first_name = 'Mary';\n\n#\n# Index examples\n#\n\n# Query based on a non-primary key column\n# Why doesn't this work?\nSELECT * FROM user WHERE last_name = 'Nguyen';\n\n# Create a secondary index for the last_name column.\nCREATE INDEX ON user ( last_name );\n\n# Now try the query again\nSELECT * FROM user WHERE last_name = 'Nguyen';\n\n# View the output of the describe command to see the full index definition\n# We didn't name the index, so Cassandra assigned a default name\nDESCRIBE KEYSPACE;\n\n# Create indexes on other attributes if desired, even collections\n# Note that queries based on indexes are typically more expensive, as they involve talking to more nodes\nCREATE INDEX ON user ( addresses );\nCREATE INDEX ON user ( emails );\nCREATE INDEX ON user ( phone_numbers );\n\n# Drop indexes we no longer want maintained\nDROP INDEX user_last_name_idx;\nDROP INDEX user_addresses_idx;\nDROP INDEX user_emails_idx;\nDROP INDEX user_phone_numbers_idx;\n\n# Create a SSTable Attached Secondary Index (SASI), which is a more performant index implementation\nCREATE CUSTOM INDEX user_last_name_sasi_idx ON user (last_name) USING 'org.apache.cassandra.index.sasi.SASIIndex';\n\n# SASI indexes allow us to perform inequality and text searches such as \"like\" searches\nSELECT * FROM user WHERE last_name LIKE 'N%';\n")),(0,s.kt)("h2",{id:"cassandra-and-python"},"Cassandra and Python"),(0,s.kt)("h3",{id:"installation"},"Installation"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-txt",metastring:'title="requirements.txt"',title:'"requirements.txt"'},"service-identity==21.1.0\ncassandra-driver==3.25.0\n")),(0,s.kt)("h3",{id:"creating-a-table-with-apache-cassandra"},"Creating a Table with Apache Cassandra"),(0,s.kt)("ol",null,(0,s.kt)("li",{parentName:"ol"},"Create a table in Apache Cassandra."),(0,s.kt)("li",{parentName:"ol"},"Insert rows of data."),(0,s.kt)("li",{parentName:"ol"},"Run a simple SQL query to validate the information.")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-py"},'from cassandra.cluster import Cluster\n\ntry: \n    cluster = Cluster([\'127.0.0.1\']) #If you have a locally installed Apache Cassandra instance\n    session = cluster.connect()\nexcept Exception as e:\n    print(e)\n \ntry:\n    session.execute("""\n    CREATE KEYSPACE IF NOT EXISTS kspace WITH REPLICATION = \n    { \'class\' : \'SimpleStrategy\', \'replication_factor\' : 1 }"""\n)\nexcept Exception as e:\n    print(e)\n\ntry:\n    session.set_keyspace(\'kspace\')\nexcept Exception as e:\n    print(e)\n\nquery = "CREATE TABLE IF NOT EXISTS music_library "\nquery = query + "(year int, artist_name text, song_title text,  album_name text, single Boolean, PRIMARY KEY (year, artist_name))"\ntry:\n    session.execute(query)\nexcept Exception as e:\n    print(e)\n\nquery = "INSERT INTO music_library (year, artist_name, song_title, album_name, single)" \nquery = query + " VALUES (%s, %s, %s, %s, %s)"\n\ntry:\n    session.execute(query, (1970, "The Beatles", "Across The Universe", "Let It Be", False))\nexcept Exception as e:\n    print(e)\n    \ntry:\n    session.execute(query, (1965 , "The Beatles", "Think For Yourself", "Rubber Soul", False))\nexcept Exception as e:\n    print(e)\n\nquery = \'SELECT * FROM music_library\'\ntry:\n    rows = session.execute(query)\nexcept Exception as e:\n    print(e)\n    \nfor row in rows:\n    print (row.year, row.album_name, row.artist_name)\n\nquery = "SELECT * FROM music_library WHERE YEAR=1970 AND artist_name=\'The Beatles\'"\ntry:\n    rows = session.execute(query)\nexcept Exception as e:\n    print(e)\n    \nfor row in rows:\n    print (row.year, row.album_name, row.artist_name)\n\nsession.shutdown()\ncluster.shutdown()\n')),(0,s.kt)("h2",{id:"three-queries-three-tables"},"Three Queries Three Tables"),(0,s.kt)("p",null,"Let's imagine we would like to start creating a Music Library of albums. "),(0,s.kt)("p",null,"We want to ask 3 questions of the data:"),(0,s.kt)("p",null,"Query 1: Give every album in the music library that was released in a given year"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sql"},"select * from music_library WHERE YEAR=1970\n")),(0,s.kt)("p",null,"Query 2: Give every album in the music library that was created by a given artist  "),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sql"},'select * from artist_library WHERE artist_name="The Beatles"\n')),(0,s.kt)("p",null,"Query 3: Give all the information from the music library about a given album"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sql"},'select * from album_library WHERE album_name="Close To You"\n')),(0,s.kt)("p",null,"Because we want to do three different queries, we will need different tables that partition the data differently. "),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"Create the tables")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-py"},'query = "CREATE TABLE IF NOT EXISTS music_library "\nquery = query + "(year int, artist_name text, album_name text, PRIMARY KEY (year, artist_name))"\ntry:\n    session.execute(query)\nexcept Exception as e:\n    print(e)\n    \nquery1 = "CREATE TABLE IF NOT EXISTS artist_library "\nquery1 = query1 + "(artist_name text, year int, album_name text, PRIMARY KEY (artist_name, year))"\ntry:\n    session.execute(query1)\nexcept Exception as e:\n    print(e)\n\nquery2 = "CREATE TABLE IF NOT EXISTS album_library "\nquery2 = query2 + "(album_name text, artist_name text, year int, PRIMARY KEY (album_name, artist_name))"\ntry:\n    session.execute(query2)\nexcept Exception as e:\n    print(e)\n')),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"Insert data into the tables")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sql"},'query = "INSERT INTO music_library (year, artist_name, album_name)"\nquery = query + " VALUES (%s, %s, %s)"\n\nquery1 = "INSERT INTO artist_library (artist_name, year, album_name)"\nquery1 = query1 + " VALUES (%s, %s, %s)"\n\nquery2 = "INSERT INTO album_library (album_name, artist_name, year)"\nquery2 = query2 + " VALUES (%s, %s, %s)"\n\ntry:\n    session.execute(query, (1970, "The Beatles", "Let it Be"))\nexcept Exception as e:\n    print(e)\n    \ntry:\n    session.execute(query, (1965, "The Beatles", "Rubber Soul"))\nexcept Exception as e:\n    print(e)\n    \ntry:\n    session.execute(query, (1965, "The Who", "My Generation"))\nexcept Exception as e:\n    print(e)\n\ntry:\n    session.execute(query, (1966, "The Monkees", "The Monkees"))\nexcept Exception as e:\n    print(e)\n\ntry:\n    session.execute(query, (1970, "The Carpenters", "Close To You"))\nexcept Exception as e:\n    print(e)\n    \ntry:\n    session.execute(query1, ("The Beatles", 1970, "Let it Be"))\nexcept Exception as e:\n    print(e)\n    \ntry:\n    session.execute(query1, ("The Beatles", 1965, "Rubber Soul"))\nexcept Exception as e:\n    print(e)\n    \ntry:\n    session.execute(query1, ("The Who", 1965, "My Generation"))\nexcept Exception as e:\n    print(e)\n\ntry:\n    session.execute(query1, ("The Monkees", 1966, "The Monkees"))\nexcept Exception as e:\n    print(e)\n\ntry:\n    session.execute(query1, ("The Carpenters", 1970, "Close To You"))\nexcept Exception as e:\n    print(e)\n    \ntry:\n    session.execute(query2, ("Let it Be", "The Beatles", 1970))\nexcept Exception as e:\n    print(e)\n    \ntry:\n    session.execute(query2, ("Rubber Soul", "The Beatles", 1965))\nexcept Exception as e:\n    print(e)\n    \ntry:\n    session.execute(query2, ("My Generation", "The Who", 1965))\nexcept Exception as e:\n    print(e)\n\ntry:\n    session.execute(query2, ("The Monkees", "The Monkees", 1966))\nexcept Exception as e:\n    print(e)\n\ntry:\n    session.execute(query2, ("Close To You", "The Carpenters", 1970))\nexcept Exception as e:\n    print(e)\n')),(0,s.kt)("admonition",{type:"tip"},(0,s.kt)("p",{parentName:"admonition"},"This might have felt unnatural to insert duplicate data into the tables. If I just normalized these tables, I wouldn't have to have extra copies! While this is true, remember there are no ",(0,s.kt)("inlineCode",{parentName:"p"},"JOINS")," in Apache Cassandra. For the benefit of high availibity and scalabity, denormalization must be how this is done.")),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"Validate the Data Model")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-py"},'query = "select * from music_library WHERE year=1970"\ntry:\n    rows = session.execute(query)\nexcept Exception as e:\n    print(e)\nfor row in rows:\n    print (row.year, row.artist_name, row.album_name)\n\nquery = "select * from artist_library WHERE artist_name=\'The Beatles\'"\ntry:\n    rows = session.execute(query)\nexcept Exception as e:\n    print(e)\nfor row in rows:\n    print (row.artist_name, row.album_name, row.year)\n\nquery = "select * from album_library WHERE album_name=\'Close To You\'"\ntry:\n    rows = session.execute(query)\nexcept Exception as e:\n    print(e)\nfor row in rows:\n    print (row.artist_name, row.year, row.album_name)\n')),(0,s.kt)("h2",{id:"using-the-where-clause"},"Using the WHERE Clause"),(0,s.kt)("p",null,"In this exercise we are going to walk through the basics of using the WHERE clause in Apache Cassandra."),(0,s.kt)("p",null,"Let's imagine we would like to start creating a new Music Library of albums. "),(0,s.kt)("p",null,"We want to ask 4 question of our data:"),(0,s.kt)("ol",null,(0,s.kt)("li",{parentName:"ol"},"Give me every album in my music library that was released in a 1965 year"),(0,s.kt)("li",{parentName:"ol"},'Give me the album that is in my music library that was released in 1965 by "The Beatles"'),(0,s.kt)("li",{parentName:"ol"},"Give me all the albums released in a given year that was made in London "),(0,s.kt)("li",{parentName:"ol"},'Give me the city that the album "Rubber Soul" was recorded')),(0,s.kt)("p",null,"How should we model this data? What should be our Primary Key and Partition Key? Since our data is looking for the YEAR let's start with that. From there we will add clustering columns on Artist Name and Album Name."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-py"},'query = "CREATE TABLE IF NOT EXISTS music_library "\nquery = query + "(year int, artist_name text, album_name text, city text, PRIMARY KEY (year, artist_name, album_name))"\ntry:\n    session.execute(query)\nexcept Exception as e:\n    print(e)\n')),(0,s.kt)("p",null,"Let's insert our data into of table:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-py"},'query = "INSERT INTO music_library (year, artist_name, album_name, city)"\nquery = query + " VALUES (%s, %s, %s, %s)"\n\ntry:\n    session.execute(query, (1970, "The Beatles", "Let it Be", "Liverpool"))\nexcept Exception as e:\n    print(e)\n    \ntry:\n    session.execute(query, (1965, "The Beatles", "Rubber Soul", "Oxford"))\nexcept Exception as e:\n    print(e)\n    \ntry:\n    session.execute(query, (1965, "The Who", "My Generation", "London"))\nexcept Exception as e:\n    print(e)\n\ntry:\n    session.execute(query, (1966, "The Monkees", "The Monkees", "Los Angeles"))\nexcept Exception as e:\n    print(e)\n\ntry:\n    session.execute(query, (1970, "The Carpenters", "Close To You", "San Diego"))\nexcept Exception as e:\n    print(e)\n')),(0,s.kt)("p",null,"Let's Validate our Data Model with our 4 queries:"),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"Query 1")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-py"},'query = "SELECT * FROM music_library WHERE year=1965"\ntry:\n    rows = session.execute(query)\nexcept Exception as e:\n    print(e)\nfor row in rows:\n    print (row.year, row.artist_name, row.album_name, row.city)\n')),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"Query 2")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-py"},"query = \"SELECT * FROM music_library WHERE year=1965 AND artist_name='The Beatles'\"\ntry:\n    rows = session.execute(query)\nexcept Exception as e:\n    print(e)\nfor row in rows:\n    print (row.year, row.artist_name, row.album_name, row.city)\n")),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"Query 3")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-py"},"query = \"SELECT * FROM music_library WHERE year=1965 AND city='London'\"\ntry:\n    rows = session.execute(query)\nexcept Exception as e:\n    print(e)\nfor row in rows:\n    print (row.year, row.artist_name, row.album_name, row.city)\n")),(0,s.kt)("admonition",{type:"caution"},(0,s.kt)("p",{parentName:"admonition"},"Did you get an error? You can not try to access a column or a clustering column if you have not used the other defined clustering column. Let's see if we can try it a different way. ")),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"Query 4")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-py"},"query = \"SELECT city FROM music_library WHERE year=1965 AND artist_name='The Beatles' AND album_name='Rubber Soul'\"\ntry:\n    rows = session.execute(query)\nexcept Exception as e:\n    print(e)\nfor row in rows:\n    print (row.city)\n")),(0,s.kt)("h2",{id:"amazon-keyspaces-for-apache-cassandra"},"Amazon Keyspaces for Apache Cassandra"),(0,s.kt)("h3",{id:"first-keyspace"},"First Keyspace"),(0,s.kt)("p",null,"Go to ",(0,s.kt)("a",{parentName:"p",href:"https://us-east-1.console.aws.amazon.com/keyspaces/home?region=us-east-1#dashboard"},"https://us-east-1.console.aws.amazon.com/keyspaces/home?region=us-east-1#dashboard")," and follow the getting started guide to create a new keyspace, a new table inside that keyspace, insert a record inside the table and run query to retrieve the results."),(0,s.kt)("h3",{id:"connect-via-pythoncqlsh-client"},"Connect via Python/CQLSH client"),(0,s.kt)("p",null,"Download the TLS certificate:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sh"},"mkdir -p ~/.cassandra\ncurl https://certs.secureserver.net/repository/sf-class2-root.crt -O ~/.cassandra/sf-class2-root.crt\n")),(0,s.kt)("p",null,"Configure the Cassandra settings:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="~/.cassandra/cqlshrc"',title:'"~/.cassandra/cqlshrc"'},"[connection]\nport = 9142\nfactory = cqlshlib.ssl.ssl_transport_factory\n\n[ssl]\nvalidate = true\ncertfile =  ~/.cassandra/sf-class2-root.crt\nversion = TLSv1_2\n\n[copy]\nNUMPROCESSES=16\nMAXATTEMPTS=25\n\n[copy-from]\nCHUNKSIZE=30\nINGESTRATE=1500\nMAXINSERTERRORS=-1\nMAXPARSEERRORS=-1\nMINBATCHSIZE=1\nMAXBATCHSIZE=10\n\n[csv]\nfield_size_limit=999999\n")),(0,s.kt)("p",null,"Use the following command to connect via CQL shell:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sh"},"cqlsh cassandra.us-east-1.amazonaws.com 9142 -u $USERNAME -p $PASSWORD --ssl\n")),(0,s.kt)("p",null,"Use the following command to connect via Python:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-py"},"from cassandra.cluster import Cluster\nfrom ssl import SSLContext, PROTOCOL_TLSv1_2 , CERT_REQUIRED\nfrom cassandra.auth import PlainTextAuthProvider\n\nUSERNAME = ''\nPASSWORD = ''\n\nssl_context = SSLContext(PROTOCOL_TLSv1_2 )\nssl_context.load_verify_locations('sf-class2-root.crt')\nssl_context.verify_mode = CERT_REQUIRED\nauth_provider = PlainTextAuthProvider(username=USERNAME, password=PASSWORD)\ncluster = Cluster(['cassandra.us-east-1.amazonaws.com'], ssl_context=ssl_context, auth_provider=auth_provider, port=9142)\nsession = cluster.connect()\nr = session.execute('select * from system_schema.keyspaces')\nprint(r.current_rows)\n")),(0,s.kt)("p",null,"Follow this for Python - ",(0,s.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/keyspaces/latest/devguide/using_python_driver.html"},"https://docs.aws.amazon.com/keyspaces/latest/devguide/using_python_driver.html")),(0,s.kt)("p",null,"Follow this for CQLSH - ",(0,s.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/keyspaces/latest/devguide/programmatic.cqlsh.html"},"https://docs.aws.amazon.com/keyspaces/latest/devguide/programmatic.cqlsh.html")),(0,s.kt)("admonition",{type:"note"},(0,s.kt)("p",{parentName:"admonition"},"No need to follow all the steps but minimal as per your system configuration.")),(0,s.kt)("h3",{id:"loading-data-into-amazon-keyspaces-using-cqlsh"},"Loading data into Amazon Keyspaces using cqlsh"),(0,s.kt)("p",null,"Follow this - ",(0,s.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/keyspaces/latest/devguide/bulk-upload.html"},"https://docs.aws.amazon.com/keyspaces/latest/devguide/bulk-upload.html")),(0,s.kt)("h3",{id:"using-nosql-workbench-with-amazon-keyspaces"},"Using NoSQL Workbench with Amazon Keyspaces"),(0,s.kt)("p",null,"Follow this - ",(0,s.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/keyspaces/latest/devguide/workbench.html"},"https://docs.aws.amazon.com/keyspaces/latest/devguide/workbench.html")))}m.isMDXComponent=!0},97218:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/killrvideo-65f06e18132ae604e73396e98eb7f745.png"}}]);