"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[71736],{3905:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>c});var n=a(67294);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function r(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var s=n.createContext({}),p=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},u=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,o=e.originalType,s=e.parentName,u=r(e,["components","mdxType","originalType","parentName"]),d=p(a),c=i,h=d["".concat(s,".").concat(c)]||d[c]||m[c]||o;return a?n.createElement(h,l(l({ref:t},u),{},{components:a})):n.createElement(h,l({ref:t},u))}));function c(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=a.length,l=new Array(o);l[0]=d;var r={};for(var s in t)hasOwnProperty.call(t,s)&&(r[s]=t[s]);r.originalType=e,r.mdxType="string"==typeof e?e:i,l[1]=r;for(var p=2;p<o;p++)l[p]=a[p];return n.createElement.apply(null,l)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},13370:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>m,frontMatter:()=>o,metadata:()=>r,toc:()=>p});var n=a(87462),i=(a(67294),a(3905));const o={},l="Lab: GCP Dataprep",r={unversionedId:"processing/lab-gcp-dataprep",id:"processing/lab-gcp-dataprep",title:"Lab: GCP Dataprep",description:"Creating a Data Transformation Pipeline with Cloud Dataprep",source:"@site/docs/03-processing/lab-gcp-dataprep.md",sourceDirName:"03-processing",slug:"/processing/lab-gcp-dataprep",permalink:"/docs/processing/lab-gcp-dataprep",draft:!1,tags:[],version:"current",lastUpdatedBy:"sparsh",lastUpdatedAt:1681732641,formattedLastUpdatedAt:"Apr 17, 2023",frontMatter:{},sidebar:"docs",previous:{title:"Lab: Implementing the Serving Layer Star Schema",permalink:"/docs/processing/lab-azure-synapse-implementing-star-schema/"},next:{title:"Pub/Sub",permalink:"/docs/processing/gcp-pubsub"}},s={},p=[{value:"Step 1: Enable DataPrep",id:"step-1-enable-dataprep",level:3},{value:"Step 2: Creating a BigQuery dataset",id:"step-2-creating-a-bigquery-dataset",level:3},{value:"Step 3: Connecting BigQuery data to Cloud Dataprep",id:"step-3-connecting-bigquery-data-to-cloud-dataprep",level:3},{value:"Step 4: Exploring ecommerce data fields with the UI",id:"step-4-exploring-ecommerce-data-fields-with-the-ui",level:3},{value:"Step 5: Cleaning the data",id:"step-5-cleaning-the-data",level:3},{value:"Step 6: Enriching the data",id:"step-6-enriching-the-data",level:3},{value:"Step 7: Running Cloud Dataprep jobs to BigQuery",id:"step-7-running-cloud-dataprep-jobs-to-bigquery",level:3}],u={toc:p};function m(e){let{components:t,...a}=e;return(0,i.kt)("wrapper",(0,n.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"lab-gcp-dataprep"},"Lab: GCP Dataprep"),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"Creating a Data Transformation Pipeline with Cloud Dataprep")),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/62965911/214003279-5d213b3a-935f-4f7a-b652-372bd7a967a2.png",alt:null})),(0,i.kt)("p",null,"Cloud Dataprep by Alteryx is an intelligent data service for visually exploring, cleaning, and preparing structured and unstructured data for analysis. In this lab you explore the Cloud Dataprep UI to build a data transformation pipeline that outputs results into BigQuery."),(0,i.kt)("p",null,"The dataset you'll use is an ",(0,i.kt)("a",{parentName:"p",href:"https://www.en.advertisercommunity.com/t5/Articles/Introducing-the-Google-Analytics-Sample-Dataset-for-BigQuery/ba-p/1676331#"},"ecommerce dataset")," that has millions of Google Analytics session records for the Google Merchandise Store loaded into BigQuery. You have a copy of that dataset for this lab and will explore the available fields and row for insights."),(0,i.kt)("p",null,"In this lab, you will learn how to perform these tasks:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Connect BigQuery datasets to Cloud Dataprep"),(0,i.kt)("li",{parentName:"ul"},"Explore dataset quality with Cloud Dataprep"),(0,i.kt)("li",{parentName:"ul"},"Create a data transformation pipeline with Cloud Dataprep"),(0,i.kt)("li",{parentName:"ul"},"Run transformation jobs outputs to BigQuery")),(0,i.kt)("h3",{id:"step-1-enable-dataprep"},"Step 1: Enable DataPrep"),(0,i.kt)("p",null,"Search for DataPrep in GCP console search box and go to the DataPrep product page. Access and enable the product."),(0,i.kt)("h3",{id:"step-2-creating-a-bigquery-dataset"},"Step 2: Creating a BigQuery dataset"),(0,i.kt)("p",null,"You need BigQuery as an endpoint for dataset ingestion to the pipeline and as a destination for the output when the pipeline is completed."),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Search for BigQuery in GCP console search box and Go to BigQuery"),(0,i.kt)("li",{parentName:"ol"},"In the left pane, under\xa0Explorer\xa0section, click on the\xa0View actions\xa0icon to the right of your project ID, then click\xa0Create dataset."),(0,i.kt)("li",{parentName:"ol"},"For\xa0Dataset ID, type\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"ecommerce"),"."),(0,i.kt)("li",{parentName:"ol"},"Leave the other values at their defaults."),(0,i.kt)("li",{parentName:"ol"},"Click\xa0CREATE DATASET. You will now see your dataset under your project in the left pane."),(0,i.kt)("li",{parentName:"ol"},"Copy and paste the following SQL query into the\xa0Query Editor:",(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"#standardSQL\nCREATE OR REPLACE TABLE ecommerce.all_sessions_raw_dataprep\nOPTIONS(\ndescription=\"Raw data from analyst team to ingest into Cloud Dataprep\"\n) AS\nSELECT * FROM `data-to-insights.ecommerce.all_sessions_raw`\nWHERE date = '20170801'; # limiting to one day of data 56k rows for this lab\n"))),(0,i.kt)("li",{parentName:"ol"},"Click\xa0RUN. This query copies over a subset of the public raw ecommerce dataset (one day's worth of session data, or about 56 thousand records) into a new table named\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"all_sessions_raw_dataprep"),", which has been added to your ecommerce dataset for you to explore and clean in Cloud Dataprep."),(0,i.kt)("li",{parentName:"ol"},"Confirm that the new table exists in your\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"ecommerce"),"\xa0dataset")),(0,i.kt)("h3",{id:"step-3-connecting-bigquery-data-to-cloud-dataprep"},"Step 3: Connecting BigQuery data to Cloud Dataprep"),(0,i.kt)("p",null,"In this step, you will connect Cloud Dataprep to your BigQuery data source. On the Cloud Dataprep page:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Click\xa0Create a new flow\xa0in the left corner."),(0,i.kt)("li",{parentName:"ol"},"Rename the\xa0Untitled Flow\xa0and specify these details:",(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"For\xa0Flow Name, type\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"Ecommerce Analytics Pipeline")),(0,i.kt)("li",{parentName:"ol"},"For\xa0Flow Description, type\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"Revenue reporting table")))),(0,i.kt)("li",{parentName:"ol"},"Click\xa0Ok."),(0,i.kt)("li",{parentName:"ol"},"If prompted with a\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"What's a flow?"),"\xa0popup, select\xa0Don't show me any helpers."),(0,i.kt)("li",{parentName:"ol"},"Click the\xa0Add Icon\xa0in the Dataset box."),(0,i.kt)("li",{parentName:"ol"},"In the\xa0Add Datasets to Flow\xa0dialog box, select\xa0Import Datasets."),(0,i.kt)("li",{parentName:"ol"},"In the left pane, click\xa0BigQuery."),(0,i.kt)("li",{parentName:"ol"},"When your\xa0ecommerce\xa0dataset is loaded, click on it."),(0,i.kt)("li",{parentName:"ol"},"Click on the\xa0Create dataset\xa0icon (+ sign) on the left of the\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"all_sessions_raw_dataprep"),"\xa0table."),(0,i.kt)("li",{parentName:"ol"},"Click\xa0Import & Add to Flow\xa0in the bottom right corner.")),(0,i.kt)("p",null,"The data source automatically updates. You are ready to go to the next step."),(0,i.kt)("h3",{id:"step-4-exploring-ecommerce-data-fields-with-the-ui"},"Step 4: Exploring ecommerce data fields with the UI"),(0,i.kt)("p",null,"In this step, you will load and explore a sample of the dataset within Cloud Dataprep."),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Click the\xa0Recipe icon\xa0and then select\xa0Edit Recipe."),(0,i.kt)("li",{parentName:"ol"},"Cloud Dataprep loads a sample of your dataset into the Transformer view. This process might take a few seconds. You are now ready to start exploring the data!")),(0,i.kt)("p",null,"Answer the following questions:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"How many columns are there in the dataset?",(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"Answer: 32 columns."))),(0,i.kt)("li",{parentName:"ol"},"How many rows does the sample contain?",(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"Answer: About 12 thousand rows."))),(0,i.kt)("li",{parentName:"ol"},"What is the most common value in the\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"channelGrouping"),"\xa0column?",(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"Hint: Find out by hovering your mouse cursor over the histogram under the\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"channelGrouping"),"\xa0column title."),(0,i.kt)("li",{parentName:"ol"},"Answer: Referral."),(0,i.kt)("li",{parentName:"ol"},"Note: A\xa0",(0,i.kt)("a",{parentName:"li",href:"https://support.google.com/analytics/answer/1011811?hl=en"},"referring site"),"\xa0is typically any other website that has a link to your content. An example here is a different website reviewed a product on our ecommerce website and linked to it. This is considered a different acquisition channel than if the visitor came from a search engine."))),(0,i.kt)("li",{parentName:"ol"},"What are the top three countries from which sessions are originated?",(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"Answer: United States, India, United Kingdom"))),(0,i.kt)("li",{parentName:"ol"},"What does the grey bar under\xa0totalTransactionRevenue\xa0represent?",(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"Answer: Missing values for the\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"totalTransactionRevenue"),"\xa0field."),(0,i.kt)("li",{parentName:"ol"},"This means that a lot of sessions in this sample did not generate revenue. Later, we will filter out these values so our final table only has customer transactions and associated revenue."))),(0,i.kt)("li",{parentName:"ol"},"What is the maximum\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"timeOnSite"),"\xa0in seconds, maximum\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"pageviews"),", and maximum\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"sessionQualityDim"),"\xa0for the data sample?",(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"Hint: Open the menu to the right of the\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"timeOnSite"),"\xa0column by clicking\xa0the\xa0Column Details\xa0menu"),(0,i.kt)("li",{parentName:"ol"},"To close the details window, click the\xa0Close Column Details\xa0(X) button in the top right corner. Then repeat the process to view details for the\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"pageviews"),"\xa0and\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"sessionQualityDim"),"\xa0columns."),(0,i.kt)("li",{parentName:"ol"},"Answers:",(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"Maximum Time On Site:\xa05,561 seconds (or 92 minutes)"),(0,i.kt)("li",{parentName:"ol"},"Maximum Pageviews:\xa0155 pages"),(0,i.kt)("li",{parentName:"ol"},"Maximum Session Quality Dimension:\xa097"))),(0,i.kt)("li",{parentName:"ol"},"Note:\xa0Your answers for maximums may vary slightly due to the data sample used by Cloud Dataprep."),(0,i.kt)("li",{parentName:"ol"},"Note on averages: Use extra caution when performing aggregations like averages over a column of data. We need to first ensure fields like\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"timeOnSite"),"\xa0are only counted once per session. We'll explore the uniqueness of visitor and session data in a later lab."))),(0,i.kt)("li",{parentName:"ol"},"Looking at the histogram for\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"sessionQualityDim"),", are the data values evenly distributed?",(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"Answer: No, they are skewed to lower values (low quality sessions), which is expected."))),(0,i.kt)("li",{parentName:"ol"},"What is the\xa0date\xa0range for the dataset? Hint: Look at\xa0date\xa0field",(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"Answer: 8/1/2017 (one day of data)"))),(0,i.kt)("li",{parentName:"ol"},"You might see a red bar under the\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"productSKU"),"\xa0column. If so, what might that mean?",(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"Answer: A red bar indicates mismatched values."),(0,i.kt)("li",{parentName:"ol"},"While sampling data, Cloud Dataprep attempts to automatically identify the type of each column. If you do not see a red bar for the\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"productSKU"),"\xa0column, then this means that Cloud Dataprep correctly identified the type for the column (i.e. the String type). If you do see a red bar, then this means that Cloud Dataprep found enough number values in its sampling to determine (incorrectly) that the type should be Integer. Cloud Dataprep also detected some non-integer values and therefore flagged those values as mismatched. In fact, the\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"productSKU"),'\xa0is not always an integer (for example, a correct value might be "GGOEGOCD078399"). So in this case, Cloud Dataprep incorrectly identified the column type: it should be a string, not an integer. You will fix that later in this lab.'))),(0,i.kt)("li",{parentName:"ol"},"Looking at the\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"v2ProductName"),"\xa0column, what are the most popular products?",(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"Answer: Nest products"))),(0,i.kt)("li",{parentName:"ol"},"Looking at the\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"v2ProductCategory"),"\xa0column, what are some of the most popular product categories?",(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"Answers: The most popular product categories are: Nest, Bags, (not set) (which means that some sessions are not associated with a category)"))),(0,i.kt)("li",{parentName:"ol"},"True or False? The most common\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"productVariant"),"\xa0is\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"COLOR"),".",(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"Answer: False. It's\xa0(not set)\xa0because most products do not have variants (80%+)"))),(0,i.kt)("li",{parentName:"ol"},"What are the two values in the\xa0type\xa0column?",(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"Answer:\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"PAGE"),"\xa0and\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"EVENT")),(0,i.kt)("li",{parentName:"ol"},'A user can have many different interaction types when browsing your website. Types include recording session data when viewing a PAGE or a special EVENT (like "clicking on a product") and other types. Multiple hit types can be triggered at the exact same time so you will often filter on type to avoid double counting. We\'ll explore this more in a later analytics lab.'))),(0,i.kt)("li",{parentName:"ol"},"What is the maximum\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"productQuantity"),"?",(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"Answer: 100 (your answer may vary)"),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"productQuantity"),"\xa0indicates how many units of that product were added to cart. 100 means 100 units of a single product was added."))),(0,i.kt)("li",{parentName:"ol"},"What is the dominant\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"currencyCode"),"\xa0for transactions?",(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"Answer:\xa0USD\xa0(United States Dollar)"))),(0,i.kt)("li",{parentName:"ol"},"Are there valid values for\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"itemQuantity"),"\xa0or\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"itemRevenue"),"?",(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"Answer: No, they are all\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"NULL"),"\xa0(or missing) values."),(0,i.kt)("li",{parentName:"ol"},"Note:\xa0After exploration, in some datasets you may find duplicative or deprecated columns. We will be using ",(0,i.kt)("inlineCode",{parentName:"li"},"productQuantity")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"productRevenue")," fields instead and dropping the ",(0,i.kt)("inlineCode",{parentName:"li"},"itemQuantity")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"itemRevenue")," fields later in this lab to prevent confusion for our report users."))),(0,i.kt)("li",{parentName:"ol"},"What percentage of\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"transactionId"),"\xa0values are valid? What does this represent for our\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"ecommerce"),"\xa0dataset?",(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"Answer: About 4.6% of transaction IDs have a valid value, which represents the average conversion rate of the website (4.6% of visitors transact)."))),(0,i.kt)("li",{parentName:"ol"},"How many\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"eCommerceAction_type"),"\xa0values are there, and what is the most common value?",(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"Hint:\xa0Count the distinct number of histogram columns."),(0,i.kt)("li",{parentName:"ol"},"Answers: There are seven values found in our sample. The most common value is zero\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"0"),"\xa0which indicates that the type is unknown. This makes sense as the majority of the web sessions on our website will not perform any ecommerce actions as they are just browsing."))),(0,i.kt)("li",{parentName:"ol"},"Using the\xa0",(0,i.kt)("a",{parentName:"li",href:"https://support.google.com/analytics/answer/3437719?hl=en"},"schema"),", what does\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"eCommerceAction_type = 6"),"\xa0represent?",(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"Hint:\xa0Search for\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"eCommerceAction"),"\xa0type and read the description for the mapping"),(0,i.kt)("li",{parentName:"ol"},'Answer: 6 maps to "Completed purchase". Later in this lab we will ingest this mapping as part of our data pipeline.')))),(0,i.kt)("h3",{id:"step-5-cleaning-the-data"},"Step 5: Cleaning the data"),(0,i.kt)("p",null,"In this task, you will clean the data by deleting unused columns, eliminating duplicates, creating calculated fields, and filtering out unwanted rows."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Converting the productSKU column data type")),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"To ensure that the\xa0productSKU\xa0column type is a string data type, open the menu to the right of the\xa0productSKU\xa0column by clicking, then click\xa0Change type > String."),(0,i.kt)("li",{parentName:"ol"},"Verify that the first step in your data transformation pipeline was created by clicking on the\xa0Recipe\xa0icon:")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Deleting unused columns")),(0,i.kt)("p",null,"As we mentioned earlier, we will be deleting the\xa0itemQuantity\xa0and\xa0itemRevenue\xa0columns as they only contain NULL values and are not useful for the purpose of this lab."),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Open the menu for the\xa0itemQuantity\xa0column, and then click\xa0Delete."),(0,i.kt)("li",{parentName:"ol"},"Repeat the process to delete the\xa0itemRevenue\xa0column.")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Deduplicating rows")),(0,i.kt)("p",null,"Your team has informed you there may be duplicate session values included in the source dataset. Let's remove these with a new deduplicate step."),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Click the\xa0Filter rows\xa0icon in the toolbar, then click\xa0Remove duplicate rows."),(0,i.kt)("li",{parentName:"ol"},"Click\xa0Add\xa0in the right-hand panel.")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Filtering out sessions without revenue")),(0,i.kt)("p",null,"Your team has asked you to create a table of all user sessions that bought at least one item from the website. Filter out user sessions with NULL revenue."),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Under the\xa0totalTransactionRevenue\xa0column, click the grey\xa0Missing values\xa0bar. All rows with a missing value for\xa0totalTransactionRevenue\xa0are now highlighted in red."),(0,i.kt)("li",{parentName:"ol"},"In the\xa0Suggestions\xa0panel, in\xa0Delete rows, click\xa0Add.")),(0,i.kt)("p",null,"This step filters your dataset to only include transactions with revenue (where\xa0totalTransactionRevenue\xa0is not NULL)."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Filtering sessions for PAGE views")),(0,i.kt)("p",null,'The dataset contains sessions of different types, for example\xa0PAGE\xa0(for page views) or\xa0EVENT\xa0(for triggered events like "viewed product categories" or "added to cart"). To avoid double counting session pageviews, add a filter to only include page view related hits.'),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"In the histogram below the\xa0type\xa0column, click the bar for\xa0PAGE. All rows with the type\xa0PAGE\xa0are now highlighted in green."),(0,i.kt)("li",{parentName:"ol"},"In the\xa0Suggestions\xa0panel, in\xa0Keep rows, and click\xa0Add.")),(0,i.kt)("h3",{id:"step-6-enriching-the-data"},"Step 6: Enriching the data"),(0,i.kt)("p",null,"Search your\xa0",(0,i.kt)("a",{parentName:"p",href:"https://support.google.com/analytics/answer/3437719?hl=en/"},"schema documentation"),"\xa0for\xa0visitId\xa0and read the description to determine if it is unique across all user sessions or just the user."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"visitId"),": an identifier for this session. This is part of the value usually stored as the\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"utmb"),"\xa0cookie. This is only unique to the user. For a completely unique ID, you should use a combination of fullVisitorId and visitId.")),(0,i.kt)("p",null,"As we see,\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"visitId"),"\xa0is not unique across all users. We will need to create a unique identifier."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Creating a new column for a unique session ID")),(0,i.kt)("p",null,"As you discovered, the dataset has no single column for a unique visitor session. Create a unique ID for each session by concatenating the\xa0fullVisitorID\xa0and\xa0visitId\xa0fields."),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Click on the\xa0Merge columns\xa0icon in the toolbar."),(0,i.kt)("li",{parentName:"ol"},"For\xa0Columns, select\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"fullVisitorId"),"\xa0and\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"visitId"),"."),(0,i.kt)("li",{parentName:"ol"},"For\xa0Separator\xa0type a single hyphen character:\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"-"),"."),(0,i.kt)("li",{parentName:"ol"},"For the\xa0New column name, type\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"unique_session_id"),"."),(0,i.kt)("li",{parentName:"ol"},"Click\xa0Add.")),(0,i.kt)("p",null,"The\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"unique_session_id"),"\xa0is now a combination of the\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"fullVisitorId"),"\xa0and\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"visitId"),". We will explore in a later lab whether each row in this dataset is at the unique session level (one row per user session) or something even more granular."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Creating a case statement for the ecommerce action type")),(0,i.kt)("p",null,"As you saw earlier, values in the\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"eCommerceAction_type"),'\xa0column are integers that map to actual ecommerce actions performed in that session. For example, 3 = "Add to Cart" or 5 = "Check out". This mapping will not be immediately apparent to our end users so let\'s create a calculated field that brings in the value name.'),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Click on\xa0Conditions\xa0in the toolbar, then click\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"Case on single column"),"."),(0,i.kt)("li",{parentName:"ol"},"For\xa0Column to evaluate, specify\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"eCommerceAction_type"),"."),(0,i.kt)("li",{parentName:"ol"},"Next to\xa0Cases (1), click\xa0Add\xa08 times for a total of 9 cases."),(0,i.kt)("li",{parentName:"ol"},"For each\xa0Case, specify the following mapping values (including the single quote characters):\n| Comparison | New value                          |\n| ---------- | ---------------------------------- |\n| ",(0,i.kt)("inlineCode",{parentName:"li"},"0"),"        | ",(0,i.kt)("inlineCode",{parentName:"li"},"'Unknown'"),"                        |\n| ",(0,i.kt)("inlineCode",{parentName:"li"},"1"),"        | ",(0,i.kt)("inlineCode",{parentName:"li"},"'Click through of product lists'")," |\n| ",(0,i.kt)("inlineCode",{parentName:"li"},"2"),"        | ",(0,i.kt)("inlineCode",{parentName:"li"},"'Product detail views'"),"           |\n| ",(0,i.kt)("inlineCode",{parentName:"li"},"3"),"        | ",(0,i.kt)("inlineCode",{parentName:"li"},"'Add product(s) to cart'"),"         |\n| ",(0,i.kt)("inlineCode",{parentName:"li"},"4"),"        | ",(0,i.kt)("inlineCode",{parentName:"li"},"'Remove product(s) from cart'"),"    |\n| ",(0,i.kt)("inlineCode",{parentName:"li"},"5"),"        | ",(0,i.kt)("inlineCode",{parentName:"li"},"'Check out'"),"                      |\n| ",(0,i.kt)("inlineCode",{parentName:"li"},"6"),"        | ",(0,i.kt)("inlineCode",{parentName:"li"},"'Completed purchase'"),"             |\n| ",(0,i.kt)("inlineCode",{parentName:"li"},"7"),"        | ",(0,i.kt)("inlineCode",{parentName:"li"},"'Refund of purchase'"),"             |\n| ",(0,i.kt)("inlineCode",{parentName:"li"},"8"),"        | ",(0,i.kt)("inlineCode",{parentName:"li"},"'Checkout options'"),"               |"),(0,i.kt)("li",{parentName:"ol"},"For\xa0New column name, type\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"eCommerceAction_label"),". Leave the other fields at their default values."),(0,i.kt)("li",{parentName:"ol"},"Click\xa0Add.")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Adjusting values in the totalTransactionRevenue column")),(0,i.kt)("p",null,"As mentioned in the\xa0",(0,i.kt)("a",{parentName:"p",href:"https://support.google.com/analytics/answer/3437719?hl=en"},"schema"),", the\xa0totalTransactionRevenue\xa0column contains values passed to Analytics multiplied by 10^6 (e.g., 2.40 would be given as 2400000). You now divide the contents of that column by 10^6 to get the original values."),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Open the menu to the right of the\xa0totalTransactionRevenue\xa0column by clicking the dropdown arrow, then select\xa0Calculate\xa0>\xa0Custom formula."),(0,i.kt)("li",{parentName:"ol"},"For\xa0Formula, type:\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"DIVIDE(totalTransactionRevenue,1000000)"),"\xa0and for\xa0New column name, type:\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"totalTransactionRevenue1"),". Notice the preview for the transformation."),(0,i.kt)("li",{parentName:"ol"},"Click\xa0Add."),(0,i.kt)("li",{parentName:"ol"},"Note:\xa0You might see a red bar under the\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"totalTransactionRevenue1"),"\xa0column. Open the menu to the right of the\xa0",(0,i.kt)("inlineCode",{parentName:"li"},"totalTransactionRevenue1"),"\xa0column, then click\xa0Change type > Decimal."),(0,i.kt)("li",{parentName:"ol"},"Review the full list of steps in your recipe."),(0,i.kt)("li",{parentName:"ol"},"You can now click\xa0Run.")),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/62965911/214003293-f447729f-e008-4742-a04e-58aa0281189a.png",alt:null})),(0,i.kt)("h3",{id:"step-7-running-cloud-dataprep-jobs-to-bigquery"},"Step 7: Running Cloud Dataprep jobs to BigQuery"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"In the\xa0Run Job\xa0page, select\xa0Dataflow\xa0for your\xa0Running Environment."),(0,i.kt)("li",{parentName:"ol"},"Under\xa0Publishing Actions, click on\xa0Edit\xa0on the right of\xa0Create-CSV."),(0,i.kt)("li",{parentName:"ol"},"In the following page, select\xa0BigQuery\xa0from the left hand menu."),(0,i.kt)("li",{parentName:"ol"},"Select your\xa0ecommerce\xa0dataset."),(0,i.kt)("li",{parentName:"ol"},"Click\xa0Create a New Table\xa0from the panel on the right."),(0,i.kt)("li",{parentName:"ol"},"Name your table\xa0revenue_reporting."),(0,i.kt)("li",{parentName:"ol"},"Select\xa0Drop the Table every run."),(0,i.kt)("li",{parentName:"ol"},"Click on\xa0Update."),(0,i.kt)("li",{parentName:"ol"},"Click\xa0RUN.")),(0,i.kt)("p",null,"Once your Cloud Dataprep job is completed, refresh your BigQuery page and confirm that the output table\xa0revenue_reporting\xa0exists."),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/62965911/214003287-a54770f5-76bc-4953-b1c9-9564fee171a6.png",alt:null})),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/62965911/214003160-35926333-1eb8-4493-b6c1-9ea64c46e20a.png",alt:null})),(0,i.kt)("p",null,"Note:\xa0If your job fails, try waiting a minute, pressing the back button on your browser, and running the job again with the same settings."),(0,i.kt)("p",null,"Congratulations!"),(0,i.kt)("p",null,"You've successfully explored your ecommerce dataset and created a data transformation pipeline with Cloud Dataprep."))}m.isMDXComponent=!0}}]);