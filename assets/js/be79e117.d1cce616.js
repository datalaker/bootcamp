"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[28787],{3905:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>m});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=n.createContext({}),c=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},u=function(e){var t=c(e.components);return n.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),d=c(a),m=r,g=d["".concat(l,".").concat(m)]||d[m]||p[m]||o;return a?n.createElement(g,i(i({ref:t},u),{},{components:a})):n.createElement(g,i({ref:t},u))}));function m(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var c=2;c<o;c++)i[c]=a[c];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},41465:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>p,frontMatter:()=>o,metadata:()=>s,toc:()=>c});var n=a(87462),r=(a(67294),a(3905));const o={},i="The Easy Ways to Clean Up Production Messes",s={unversionedId:"storage/lab-production-cleaning-deltalake/README",id:"storage/lab-production-cleaning-deltalake/README",title:"The Easy Ways to Clean Up Production Messes",description:"When it comes to working with production data, messes are bound to happen. Whether it\u2019s data inconsistency, schema errors, or other issues, cleaning up production messes can be a time-consuming and frustrating process. Fortunately, Delta Lake provides a powerful toolset for handling these types of issues, making it easy to fix production messes quickly and efficiently.",source:"@site/docs/02-storage/lab-production-cleaning-deltalake/README.md",sourceDirName:"02-storage/lab-production-cleaning-deltalake",slug:"/storage/lab-production-cleaning-deltalake/",permalink:"/docs/storage/lab-production-cleaning-deltalake/",draft:!1,tags:[],version:"current",lastUpdatedBy:"sparsh",lastUpdatedAt:1681047270,formattedLastUpdatedAt:"Apr 9, 2023",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"JSON Data Processing",permalink:"/docs/storage/lab-processing-json-data/"},next:{title:"Lab: Read Delta Tables stored in Amazon S3 with Python",permalink:"/docs/storage/lab-read-s3-delta-in-python/"}},l={},c=[{value:"Optimization",id:"optimization",level:2},{value:"Time Travel",id:"time-travel",level:2},{value:"Making Corrections using ACID in Serving Layer",id:"making-corrections-using-acid-in-serving-layer",level:2},{value:"Conclusion",id:"conclusion",level:2}],u={toc:c};function p(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"the-easy-ways-to-clean-up-production-messes"},"The Easy Ways to Clean Up Production Messes"),(0,r.kt)("p",null,"When it comes to working with production data, messes are bound to happen. Whether it\u2019s data inconsistency, schema errors, or other issues, cleaning up production messes can be a time-consuming and frustrating process. Fortunately, Delta Lake provides a powerful toolset for handling these types of issues, making it easy to fix production messes quickly and efficiently."),(0,r.kt)("p",null,"In this tutorial, we\u2019ll walk through three key features of Delta Lake that can help you clean up production messes with ease: ",(0,r.kt)("strong",{parentName:"p"},"Optimization, Time travel, and making corrections using ACID in the serving layer.")),(0,r.kt)("h2",{id:"optimization"},"Optimization"),(0,r.kt)("p",null,"Delta Lake provides a powerful optimization engine that can significantly improve query performance and reduce storage costs. By optimizing the layout of data on disk, Delta Lake can achieve faster query times, reduced storage costs, and improved scalability."),(0,r.kt)("p",null,"To optimize a Delta table, you can use the ",(0,r.kt)("inlineCode",{parentName:"p"},"OPTIMIZE")," command. This command rewrites the data in the table to ensure that it is stored in the most efficient way possible."),(0,r.kt)("p",null,"For example, to optimize a Delta table located at ",(0,r.kt)("inlineCode",{parentName:"p"},"/path/to/delta_table"),", you can run the following command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"OPTIMIZE delta.`/path/to/delta_table`\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"This command will rewrite the data in the Delta table to ensure that it is optimized for query performance.")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/62965911/223409895-fb7de7e8-41ad-427c-b6f1-cd39309b4cf8.png",alt:"1_DZg6iddvSkmMgJgNXooxbg"})),(0,r.kt)("h2",{id:"time-travel"},"Time Travel"),(0,r.kt)("p",null,"Data engineering pipelines often go awry, especially when ingesting \u201cdirty\u201d data from external systems. However, in a traditional data lake design, it is hard to undo updates that added objects into a table."),(0,r.kt)("p",null,"Delta Lake\u2019s time travel feature provides a powerful tool for diagnosing and troubleshooting production issues. Delta Lake allows automatic versioning of all data stored in the data lake and we can time travel to any version. With time travel, you can query data snapshots as they existed at a specific point in time, making it easy to pinpoint when a particular issue occurred."),(0,r.kt)("p",null,"To use time travel, you can use the ",(0,r.kt)("inlineCode",{parentName:"p"},"HISTORY")," command to retrieve a specific version of the Delta table. For example, to retrieve a Delta table at a specific version, you can run the following command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"RESTORE TABLE delta_table TO VERSION AS OF 0\n")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/62965911/223410209-f326a6de-073f-42c7-b807-3a80e88214ac.png",alt:"1_UJTEr0_eZw9_N-lC8aTV2w"})),(0,r.kt)("h2",{id:"making-corrections-using-acid-in-serving-layer"},"Making Corrections using ACID in Serving Layer"),(0,r.kt)("p",null,"One of the most powerful features of Delta Lake is its support for ACID transactions in the serving layer. This means that you can make corrections to the data directly in the serving layer, without having to rewrite the entire table."),(0,r.kt)("p",null,"To make corrections using ACID in the serving layer, you can use the ",(0,r.kt)("inlineCode",{parentName:"p"},"MERGE")," command. This command allows you to update or insert data into a Delta table using a SQL query."),(0,r.kt)("p",null,"For example, to update data in a Delta table, you can run the following command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"MERGE INTO users\nUSING updates\nON users.userId \\= updates.userId\nWHEN MATCHED THEN\n UPDATE SET address \\= updates.addresses\nWHEN NOT MATCHED THEN\n INSERT (userId, address) VALUES (updates.userId, updates.address)\n")),(0,r.kt)("p",null,"This code updates the Delta table with the new data."),(0,r.kt)("h2",{id:"conclusion"},"Conclusion"),(0,r.kt)("p",null,"By using these powerful features of Delta, you can easily fix production messes without having to spend hours troubleshooting or rewriting entire tables."))}p.isMDXComponent=!0}}]);