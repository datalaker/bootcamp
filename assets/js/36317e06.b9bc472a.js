"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[33246],{3905:(e,t,r)=>{r.d(t,{Zo:()=>c,kt:()=>h});var a=r(67294);function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},o=Object.keys(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var i=a.createContext({}),u=function(e){var t=a.useContext(i),r=t;return e&&(r="function"==typeof e?e(t):s(s({},t),e)),r},c=function(e){var t=u(e.components);return a.createElement(i.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var r=e.components,n=e.mdxType,o=e.originalType,i=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=u(r),h=n,m=d["".concat(i,".").concat(h)]||d[h]||p[h]||o;return r?a.createElement(m,s(s({ref:t},c),{},{components:r})):a.createElement(m,s({ref:t},c))}));function h(e,t){var r=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=r.length,s=new Array(o);s[0]=d;var l={};for(var i in t)hasOwnProperty.call(t,i)&&(l[i]=t[i]);l.originalType=e,l.mdxType="string"==typeof e?e:n,s[1]=l;for(var u=2;u<o;u++)s[u]=r[u];return a.createElement.apply(null,s)}return a.createElement.apply(null,r)}d.displayName="MDXCreateElement"},4640:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>i,contentTitle:()=>s,default:()=>p,frontMatter:()=>o,metadata:()=>l,toc:()=>u});var a=r(87462),n=(r(67294),r(3905));const o={},s="Cursor",l={unversionedId:"foundations/language/sql/cursor",id:"foundations/language/sql/cursor",title:"Cursor",description:"To handle a result set inside a\xa0stored procedure, you use a cursor. A cursor allows you to\xa0iterate\xa0a set of rows returned by a query and process each row individually.",source:"@site/docs/01-foundations/language/sql/cursor.md",sourceDirName:"01-foundations/language/sql",slug:"/foundations/language/sql/cursor",permalink:"/docs/foundations/language/sql/cursor",draft:!1,tags:[],version:"current",lastUpdatedBy:"sparsh",lastUpdatedAt:1681451444,formattedLastUpdatedAt:"Apr 14, 2023",frontMatter:{},sidebar:"docs",previous:{title:"Comments",permalink:"/docs/foundations/language/sql/comments"},next:{title:"SQL Aggregate Functions",permalink:"/docs/foundations/language/sql/aggregate-functions"}},i={},u=[],c={toc:u};function p(e){let{components:t,...r}=e;return(0,n.kt)("wrapper",(0,a.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"cursor"},"Cursor"),(0,n.kt)("p",null,"To handle a result set inside a\xa0",(0,n.kt)("a",{parentName:"p",href:"https://www.mysqltutorial.org/mysql-stored-procedure-tutorial.aspx",title:"MySQL Stored Procedure"},"stored procedure"),", you use a cursor. A cursor allows you to\xa0",(0,n.kt)("a",{parentName:"p",href:"https://www.mysqltutorial.org/stored-procedures-loop.aspx",title:"How to use loop in stored procedure"},"iterate\xa0"),"a set of rows returned by a query and process each row individually."),(0,n.kt)("p",null,"MySQL cursor is read-only, non-scrollable and asensitive."),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Read-only: you cannot update data in the underlying table through the cursor."),(0,n.kt)("li",{parentName:"ul"},"Non-scrollable: you can only fetch rows in the order determined by the\xa0",(0,n.kt)("a",{parentName:"li",href:"https://www.mysqltutorial.org/mysql-select-statement-query-data.aspx"},"SELECT"),"\xa0statement. You cannot fetch rows in the reversed order. In addition, you cannot skip rows or jump to a specific row in the result set."),(0,n.kt)("li",{parentName:"ul"},"Asensitive: there are two kinds of cursors: asensitive cursor and insensitive cursor. An asensitive cursor points to the actual data, whereas an insensitive cursor uses a temporary copy of the data. An asensitive cursor performs faster than an insensitive cursor because it does not have to make a temporary copy of data. However, any change that made to the data from other connections will affect the data that is being used by an asensitive cursor, therefore, it is safer if you do not update the data that is being used by an asensitive cursor. MySQL cursor is asensitive.")),(0,n.kt)("p",null,"You can use MySQL cursors in\xa0",(0,n.kt)("a",{parentName:"p",href:"https://www.mysqltutorial.org/getting-started-with-mysql-stored-procedures.aspx"},"stored procedures"),",\xa0",(0,n.kt)("a",{parentName:"p",href:"https://www.mysqltutorial.org/mysql-stored-function/"},"stored functions"),", and\xa0",(0,n.kt)("a",{parentName:"p",href:"https://www.mysqltutorial.org/mysql-triggers.aspx",title:"MySQL Triggers"},"triggers"),"."),(0,n.kt)("p",null,"First, declare a cursor by using the\xa0",(0,n.kt)("inlineCode",{parentName:"p"},"DECLARE"),"\xa0statement:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-sql"},"DECLARE cursor_name CURSOR FOR SELECT_statement;\n")),(0,n.kt)("p",null,"The cursor declaration must be after any\xa0",(0,n.kt)("a",{parentName:"p",href:"https://www.mysqltutorial.org/variables-in-stored-procedures.aspx",title:"MySQL Variables in Stored Procedures"},"variable\xa0"),"declaration. If you declare a cursor before the variable declarations, MySQL will issue an error. A cursor must always associate with a\xa0",(0,n.kt)("inlineCode",{parentName:"p"},"SELECT"),"\xa0statement."),(0,n.kt)("p",null,"Next, open the cursor by using the\xa0",(0,n.kt)("inlineCode",{parentName:"p"},"OPEN"),"\xa0statement. The\xa0",(0,n.kt)("inlineCode",{parentName:"p"},"OPEN"),"\xa0statement initializes the result set for the cursor, therefore, you must call the\xa0",(0,n.kt)("inlineCode",{parentName:"p"},"OPEN"),"\xa0statement before fetching rows from the result set."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-sql"},"OPEN cursor_name;\n")),(0,n.kt)("p",null,"Then, use the\xa0",(0,n.kt)("inlineCode",{parentName:"p"},"FETCH"),"\xa0statement to retrieve the next row pointed by the cursor and move the cursor to the next row in the result set."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-sql"},"FETCH cursor_name INTO variables list;\n")),(0,n.kt)("p",null,"After that, check if there is any row available before fetching it."),(0,n.kt)("p",null,"Finally, deactivate the cursor and release the memory associated with it\xa0 using the\xa0",(0,n.kt)("inlineCode",{parentName:"p"},"CLOSE"),"\xa0statement:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-sql"},"CLOSE cursor_name;\n")),(0,n.kt)("p",null,"It is a good practice to always close a cursor when it is no longer used."),(0,n.kt)("p",null,"When working with MySQL cursor, you must also declare a\xa0",(0,n.kt)("inlineCode",{parentName:"p"},"NOT FOUND"),"\xa0handler to handle the situation when the cursor could not find any row."),(0,n.kt)("p",null,"Because each time you call the\xa0",(0,n.kt)("inlineCode",{parentName:"p"},"FETCH"),"\xa0statement, the cursor attempts to read the next row in the result set. When the cursor reaches the end of the result set, it will not be able to get the data, and a condition is raised. The handler is used to handle this condition."),(0,n.kt)("p",null,"To declare a\xa0",(0,n.kt)("inlineCode",{parentName:"p"},"NOT FOUND"),"\xa0handler, you use the following syntax:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-sql"},"\nDECLARE CONTINUE HANDLER FOR NOT FOUND SET finished = 1;\n")),(0,n.kt)("p",null,"The\xa0",(0,n.kt)("inlineCode",{parentName:"p"},"finished"),"\xa0is a variable to indicate that the cursor has reached the end of the result set. Notice that the handler declaration must appear after variable and cursor declaration inside the stored procedures."),(0,n.kt)("p",null,"The following diagram illustrates how MySQL cursor works:"),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/62965911/222632160-ccbd8671-684e-4176-8273-5baab4d4eed3.png",alt:"mysql-cursor"})))}p.isMDXComponent=!0}}]);