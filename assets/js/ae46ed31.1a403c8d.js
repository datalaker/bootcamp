"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[85428],{3905:(e,a,t)=>{t.d(a,{Zo:()=>c,kt:()=>m});var n=t(67294);function r(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function s(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function o(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?s(Object(t),!0).forEach((function(a){r(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function i(e,a){if(null==e)return{};var t,n,r=function(e,a){if(null==e)return{};var t,n,r={},s=Object.keys(e);for(n=0;n<s.length;n++)t=s[n],a.indexOf(t)>=0||(r[t]=e[t]);return r}(e,a);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)t=s[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var l=n.createContext({}),d=function(e){var a=n.useContext(l),t=a;return e&&(t="function"==typeof e?e(a):o(o({},a),e)),t},c=function(e){var a=d(e.components);return n.createElement(l.Provider,{value:a},e.children)},u={inlineCode:"code",wrapper:function(e){var a=e.children;return n.createElement(n.Fragment,{},a)}},p=n.forwardRef((function(e,a){var t=e.components,r=e.mdxType,s=e.originalType,l=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),p=d(t),m=r,h=p["".concat(l,".").concat(m)]||p[m]||u[m]||s;return t?n.createElement(h,o(o({ref:a},c),{},{components:t})):n.createElement(h,o({ref:a},c))}));function m(e,a){var t=arguments,r=a&&a.mdxType;if("string"==typeof e||r){var s=t.length,o=new Array(s);o[0]=p;var i={};for(var l in a)hasOwnProperty.call(a,l)&&(i[l]=a[l]);i.originalType=e,i.mdxType="string"==typeof e?e:r,o[1]=i;for(var d=2;d<s;d++)o[d]=t[d];return n.createElement.apply(null,o)}return n.createElement.apply(null,t)}p.displayName="MDXCreateElement"},66043:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>s,metadata:()=>i,toc:()=>d});var n=t(87462),r=(t(67294),t(3905));const s={},o="Cassandra",i={unversionedId:"storage/cassandra",id:"storage/cassandra",title:"Cassandra",description:"Apache Cassandra is an open source, distributed, decentralized, elastically scalable, highly available, fault-tolerant, tuneably consistent, row-oriented database. Cassandra bases its distribution design on Amazon\u2019s Dynamo and its data model on Google\u2019s Bigtable, with a query language similar to SQL. Created at Facebook, it now powers cloud-scale applications across many industries.",source:"@site/docs/02-storage/cassandra.md",sourceDirName:"02-storage",slug:"/storage/cassandra",permalink:"/docs/storage/cassandra",draft:!1,tags:[],version:"current",lastUpdatedBy:"sparsh",lastUpdatedAt:1681047270,formattedLastUpdatedAt:"Apr 9, 2023",frontMatter:{},sidebar:"docs",previous:{title:"Links",permalink:"/docs/storage/database-links"},next:{title:"BigTable",permalink:"/docs/storage/gcp-bigtable"}},l={},d=[{value:"How does Cassandra work?",id:"how-does-cassandra-work",level:3},{value:"The CAP theorem: is Cassandra AP or CP?",id:"the-cap-theorem-is-cassandra-ap-or-cp",level:3},{value:"CQL vs. SQL",id:"cql-vs-sql",level:3},{value:"Makefile",id:"makefile",level:3},{value:"Install Cassandra",id:"install-cassandra",level:3},{value:"Install DataStax Bulk Loader",id:"install-datastax-bulk-loader",level:3},{value:"To download and install JVM",id:"to-download-and-install-jvm",level:3},{value:"Amazon Keyspaces",id:"amazon-keyspaces",level:2},{value:"Explore Further",id:"explore-further",level:3}],c={toc:d};function u(e){let{components:a,...t}=e;return(0,r.kt)("wrapper",(0,n.Z)({},c,t,{components:a,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"cassandra"},"Cassandra"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("em",{parentName:"p"},"Apache Cassandra is an open source, distributed, decentralized, elastically scalable, highly available, fault-tolerant, tuneably consistent, row-oriented database. Cassandra bases its distribution design on Amazon\u2019s Dynamo and its data model on Google\u2019s Bigtable, with a query language similar to SQL. Created at Facebook, it now powers cloud-scale applications across many industries."))),(0,r.kt)("p",null,"Cassandra first started as an Incubator project at Apache in January of 2009. Shortly thereafter, the committers, led by Apache Cassandra Project Chair Jonathan Ellis, released version 0.3 of Cassandra, and steadily made releases up to the milestone 3.0 release. Since 2017, the project has been led by Apache Cassandra Project Chair Nate McCall, producing releases 3.1 through the latest 4.0 release. Cassandra is being used in production by some of the biggest companies on the web, including Facebook, Twitter, and Netflix."),(0,r.kt)("p",null,"Its popularity is due in large part to the outstanding technical features it provides. It is durable, seamlessly scalable, and tuneably consistent. It performs blazingly fast writes, can store hundreds of terabytes of data, and is decentralized and symmetrical so there\u2019s no single point of failure. It is highly available and offers a data model based on the Cassandra Query Language (CQL)."),(0,r.kt)("p",null,"For example, at Netflix, Cassandra runs 30 million ops/second on its most active single cluster and 98% of streaming data is stored on Cassandra. Apple runs 160,000+ Cassandra instances with thousands of clusters."),(0,r.kt)("p",null,"There are eight features that makes Cassandra powerful:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Big data ready:")," Partitioning over distributed architecture makes the database capable of handling data of any size: at petabyte scale. Need more volume? Add more nodes."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Read-write performance:")," A single node is very performant, but a cluster with multiple nodes and data centers brings throughput to the next level. Decentralization (leaderless architecture) means that every node can deal with any request, read or write."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Linear scalability:")," There are no limitations on volume or velocity and no overhead on new nodes. Cassandra scales with your needs."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Highest availability:")," Theoretically, you can achieve 100% uptime thanks to replication, decentralization and topology-aware placement strategy."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Self-healing and automation:")," Operations for a huge cluster can be exhausting. Cassandra clusters alleviate a lot of headaches because they are smart \u2014 able to scale, change data replacement, and recover \u2014 all automatically."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Geographical distribution:")," Multi-data center deployments grant an exceptional capability for disaster tolerance while keeping your data close to your clients, wherever they are in the world."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Platform agnostic:")," Cassandra is not bound to any platform or service provider, which allows you to build hybrid-cloud and multi-cloud solutions with ease."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Vendor independent:")," Cassandra doesn\u2019t belong to any of the commercial vendors but is offered by a non-profit open-source Apache Software Foundation, ensuring both open availability and continued development.")),(0,r.kt)("h3",{id:"how-does-cassandra-work"},"How does Cassandra work?"),(0,r.kt)("p",null,"In Cassandra, all servers are created equal. Unlike traditional architecture, where there\u2019s a leader server for write/read and follower servers for read-only, leading to a single point of failure, Cassandra\u2019s leader-less (peer to peer) architecture distributes data across multiple nodes within clusters (also known as data centers or rings)."),(0,r.kt)("p",null,"A node represents a single instance of Cassandra, and each node stores a few terabytes of data. Nodes \u201cgossip\u201d or exchange state information about itself and other nodes across the cluster for data consistency. When one node fails, the application contacts another node, ensuring 100% uptime."),(0,r.kt)("p",null,"In Cassandra, data is replicated. The replication factor (RF) represents the number of nodes used to store your data. If RF = 1, every partition is stored on one node. If RF = 2, then every partition is stored on two nodes, and so on. The industry standard is a replication factor of three, though there are cases that call for using more or fewer nodes."),(0,r.kt)("p",null,"Cassandra uses key-based partitioning. The main components of Cassandra\u2019s data structure include:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Keyspace:")," A container of data, similar to a schema, which contains several tables."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Table:")," A set of columns, primary key, and rows storing data in partitions."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Partition:")," A group of rows together with the same partition token (a base unit of access in Cassandra)."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Row:")," A single, structured data item in a table.")),(0,r.kt)("p",null,"Cassandra stores data in partitions, representing a set of rows in a table across a cluster. Each row contains a partition key \u2014 one or more columns that are hashed to determine how data is distributed across the nodes in the cluster."),(0,r.kt)("p",null,"Why partitioning? Because this makes scaling so much easier! Big Data doesn\u2019t fit in a single server. Instead, it\u2019s split into chunks that are easily spread over dozens, hundreds or even thousands of servers, adding more if needed."),(0,r.kt)("p",null,"Once you set a partition key for your table, a partitioner transforms the value in the partition key to tokens (also called hashing) and assigns every node with a range of data called a token range."),(0,r.kt)("p",null,"Cassandra then distributes each row of data across the cluster by the token value automatically. If you need to scale up, just add a new node, and your data gets redistributed according to the new token range assignments. On the flip side, you can also scale down hassle-free."),(0,r.kt)("p",null,"Data architects need to know how to create a partition that returns queries accurately and quickly before they create a data model. Once you\u2019ve set a primary key for your table, it cannot be changed. Instead, you\u2019ll need to create a new table and migrate all the new data."),(0,r.kt)("h3",{id:"the-cap-theorem-is-cassandra-ap-or-cp"},"The CAP theorem: is Cassandra AP or CP?"),(0,r.kt)("p",null,"Any database system, including Cassandra, has to guarantee partition tolerance: It must continue to function during data losses or system failures. To achieve partition tolerance, databases have to either prioritize consistency over availability \u201cCP,\u201d or availability over consistency or \u201cAP\u201d."),(0,r.kt)("p",null,"Cassandra is usually described as an \u201cAP\u201d system, meaning it errs on the side of ensuring data availability even if this means sacrificing consistency. But that\u2019s not the whole picture. Cassandra is configurably consistent: You can set the Consistency Level you need and tune it to be more AP or CP according to your use case."),(0,r.kt)("h3",{id:"cql-vs-sql"},"CQL vs. SQL"),(0,r.kt)("p",null,"If you are familiar with SQL, CQL may look quite similar. Indeed, there are many syntactic similarities between the two languages, but there are also many important differences. Here are just a few facts about CQL that highlight some of the differences:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"CQL supports tables with single-row and multi-row partitions"),(0,r.kt)("li",{parentName:"ul"},"CQL table primary key consists of a mandatory partition key and an optional clustering key"),(0,r.kt)("li",{parentName:"ul"},"CQL does not support referential integrity constraints"),(0,r.kt)("li",{parentName:"ul"},"CQL updates or inserts may result in upserts"),(0,r.kt)("li",{parentName:"ul"},"CQL queries cannot retrieve data based on an arbitrary table column"),(0,r.kt)("li",{parentName:"ul"},"CQL supports no joins or other binary operations"),(0,r.kt)("li",{parentName:"ul"},"CQL CRUD operations are executed with a tunable consistency level"),(0,r.kt)("li",{parentName:"ul"},"CQL supports lightweight transactions but not ACID transactions")),(0,r.kt)("h3",{id:"makefile"},"Makefile"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-makefile"},"connect:\n    import os\n    from cassandra.cqlengine.models import Model\n    from cassandra.cqlengine import columns\n    from datetime import datetime\n    import pandas as pd\n    from datetime import datetime\n\n    from cassandra.cqlengine.management import sync_table\n    from cassandra.policies import TokenAwarePolicy\n    from cassandra.auth import PlainTextAuthProvider\n    from cassandra.cluster import (\n        Cluster,\n        DCAwareRoundRobinPolicy\n    )\n    from cassandra.cqlengine.connection import (\n        register_connection,\n        set_default_connection\n    )\n\n    CASSANDRA_USERNAME='cassandra'\n    CASSANDRA_PASSWORD='cassandra'\n    CASSANDRA_HOST='127.0.0.1'\n    CASSANDRA_PORT=9042\n    session = None\n    cluster = None\n\n    auth_provider = PlainTextAuthProvider(username=CASSANDRA_USERNAME, password=CASSANDRA_PASSWORD)\n    cluster = Cluster([CASSANDRA_HOST],\n    load_balancing_policy=TokenAwarePolicy(DCAwareRoundRobinPolicy()),\n    port=CASSANDRA_PORT,\n    auth_provider=auth_provider,\n    executor_threads=2,\n    protocol_version=4,\n    )   \n\n    session = cluster.connect()\n    register_connection(str(session), session=session)\n    set_default_connection(str(session))\n    rows = session.execute('select * from demo.click_stream;')\n    df = pd.DataFrame(list(rows))\n    df.head()\n")),(0,r.kt)("h3",{id:"install-cassandra"},"Install Cassandra"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"wget https://dlcdn.apache.org/cassandra/4.0.6/apache-cassandra-4.0.6-bin.tar.gz\n\ntar -xvf apache-cassandra-4.0.6-bin.tar.gz\n\nmv apache-cassandra-4.0.6 ~/cassandra\n")),(0,r.kt)("p",null,"Add ",(0,r.kt)("inlineCode",{parentName:"p"},'export PATH="$HOME/cassandra/bin:$PATH"')," in your bash profile. Validate by running ",(0,r.kt)("inlineCode",{parentName:"p"},"cassandra --version"),". It will show ",(0,r.kt)("inlineCode",{parentName:"p"},"4.0.6"),"."),(0,r.kt)("p",null,"Congratulations! Now your Cassandra server should be up and running with a new single-node cluster called \u201cTest Cluster,\u201d ready to interact with other nodes and clients."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Run server: ",(0,r.kt)("inlineCode",{parentName:"li"},"cassandra -f"))),(0,r.kt)("h3",{id:"install-datastax-bulk-loader"},"Install DataStax Bulk Loader"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"wget https://downloads.datastax.com/dsbulk/dsbulk-1.10.0.tar.gz\n\ntar -xvf dsbulk-1.10.0.tar.gz\n\nmv dsbulk-1.10.0 ~/dsbulk\n\nrm dsbulk-1.10.0.tar.gz\n")),(0,r.kt)("p",null,"Add ",(0,r.kt)("inlineCode",{parentName:"p"},'export PATH="$HOME/dsbulk/bin:$PATH"')," in your bash profile."),(0,r.kt)("h3",{id:"to-download-and-install-jvm"},"To download and install JVM"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Go to ",(0,r.kt)("a",{parentName:"li",href:"https://www.oracle.com/java/technologies/downloads/#java8-mac"},"https://www.oracle.com/java/technologies/downloads/#java8-mac")," or ",(0,r.kt)("a",{parentName:"li",href:"https://download.oracle.com/otn/java/jdk/8u341-b10/424b9da4b48848379167015dcc250d8d/jdk-8u341-macosx-x64.dmg"},"https://download.oracle.com/otn/java/jdk/8u341-b10/424b9da4b48848379167015dcc250d8d/jdk-8u341-macosx-x64.dmg")," (for mac users)"),(0,r.kt)("li",{parentName:"ol"},"Install the downloaded package"),(0,r.kt)("li",{parentName:"ol"},"Run these commands to set java path")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"/usr/libexec/java_home\nexport JAVA_HOME=$(/usr/libexec/java_home)\nsource .bash_profile\n")),(0,r.kt)("h2",{id:"amazon-keyspaces"},"Amazon Keyspaces"),(0,r.kt)("p",null,"Watch this video: ",(0,r.kt)("a",{parentName:"p",href:"https://www.youtube.com/watch?v=PYdLIvBHe2E"},"https://www.youtube.com/watch?v=PYdLIvBHe2E")),(0,r.kt)("h3",{id:"explore-further"},"Explore Further"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"https://bit.ly/3fsVUAR"},"Introduction to Apache Cassandra - the \u201cLamborghini\u201d of the NoSQL World")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"https://youtu.be/J-cSy5MeMOA"},"Apache Cassandra Database \u2013 Full Course for Beginners")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"https://youtu.be/PYdLIvBHe2E"},"Overview of Amazon Keyspaces")," [",(0,r.kt)("a",{parentName:"li",href:"https://youtu.be/KPh_8DeRgxQ"},"Long"),"]"),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"https://cassandra.apache.org/_/case-studies.html"},"Cassandra Case Studies")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"https://cassandra.apache.org/_/case-studies.html"},"Cassandra Case Studies")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"https://youtu.be/KPh_8DeRgxQ"},"AWS re:Invent 2020: Running Apache Cassandra workloads with Amazon Keyspaces"))))}u.isMDXComponent=!0}}]);