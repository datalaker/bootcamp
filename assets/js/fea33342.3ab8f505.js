"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[92480],{3905:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>m});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),d=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},u=function(e){var t=d(e.components);return n.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),c=d(a),m=r,h=c["".concat(s,".").concat(m)]||c[m]||p[m]||i;return a?n.createElement(h,l(l({ref:t},u),{},{components:a})):n.createElement(h,l({ref:t},u))}));function m(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,l=new Array(i);l[0]=c;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o.mdxType="string"==typeof e?e:r,l[1]=o;for(var d=2;d<i;d++)l[d]=a[d];return n.createElement.apply(null,l)}return n.createElement.apply(null,a)}c.displayName="MDXCreateElement"},15783:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>p,frontMatter:()=>i,metadata:()=>o,toc:()=>d});var n=a(87462),r=(a(67294),a(3905));const i={},l="GCP BigQuery NYC Taxi",o={unversionedId:"storage/lab-bigquery-nyctaxi/README",id:"storage/lab-bigquery-nyctaxi/README",title:"GCP BigQuery NYC Taxi",description:"Objective",source:"@site/docs/02-storage/lab-bigquery-nyctaxi/README.md",sourceDirName:"02-storage/lab-bigquery-nyctaxi",slug:"/storage/lab-bigquery-nyctaxi/",permalink:"/docs/storage/lab-bigquery-nyctaxi/",draft:!1,tags:[],version:"current",lastUpdatedBy:"sparsh",lastUpdatedAt:1681047270,formattedLastUpdatedAt:"Apr 9, 2023",frontMatter:{}},s={},d=[{value:"Objective",id:"objective",level:2},{value:"Challenge scenario",id:"challenge-scenario",level:3},{value:"Your challenge",id:"your-challenge",level:3},{value:"Task 1. Clean your training data",id:"task-1-clean-your-training-data",level:3},{value:"Task 2. Create a BigQuery ML model",id:"task-2-create-a-bigquery-ml-model",level:3},{value:"Task 3. Perform a batch prediction on new data",id:"task-3-perform-a-batch-prediction-on-new-data",level:3}],u={toc:d};function p(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"gcp-bigquery-nyc-taxi"},"GCP BigQuery NYC Taxi"),(0,r.kt)("h2",{id:"objective"},"Objective"),(0,r.kt)("h3",{id:"challenge-scenario"},"Challenge scenario"),(0,r.kt)("p",null,"You have started a new role as a Data Engineer for TaxiCab Inc. You are expected to import some historical data to a working BigQuery dataset, and build a basic model that predicts fares based on information available when a new ride starts. Leadership is interested in building an app and estimating for users how much a ride will cost. The source data will be provided in your project."),(0,r.kt)("p",null,"You are expected to have the skills and knowledge for these tasks, so don't expect step-by-step guides to be provided."),(0,r.kt)("h3",{id:"your-challenge"},"Your challenge"),(0,r.kt)("p",null,"As soon as you sit down at your desk and open your new laptop you receive your first assignment: build a basic BQML fare prediction model for leadership. Perform the following tasks to import and clean the data, then build the model and perform batch predictions with new data so that leadership can review model performance and make a go/no-go decision on deploying the app functionality."),(0,r.kt)("h3",{id:"task-1-clean-your-training-data"},"Task 1. Clean your training data"),(0,r.kt)("p",null,"You've already completed the first step, and have created a dataset\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"taxirides"),"\xa0and imported the historical data to table,\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"historical_taxi_rides_raw"),". This is data prior for rides to 2015."),(0,r.kt)("p",null,"Note:\xa0You may need to wait 1-3 minutes for the data to be fully populated in your project."),(0,r.kt)("p",null,"To complete this task you will need to:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Clean the data in\xa0",(0,r.kt)("inlineCode",{parentName:"li"},"historical_taxi_rides_raw"),"\xa0and make a copy to\xa0",(0,r.kt)("inlineCode",{parentName:"li"},"Table"),"\xa0in the same dataset. You can use BigQuery, DataPrep, DataFlow, etc. to create this table and clean the data. Make sure your target column is called\xa0",(0,r.kt)("inlineCode",{parentName:"li"},"Fare amount"),"\xa0.")),(0,r.kt)("p",null,"Some helpful hints:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"You can see the source dataset in the BQ UI - familiarize yourself with the source schema first."),(0,r.kt)("li",{parentName:"ul"},"As a hint for the data available at prediction time, familiarize yourself with the table\xa0",(0,r.kt)("inlineCode",{parentName:"li"},"taxirides.report_prediction_data"),"\xa0which shows the format data will arrive at prediction time.")),(0,r.kt)("p",null,"Data cleaning tasks:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Ensure\xa0",(0,r.kt)("inlineCode",{parentName:"li"},"trip_distance"),"\xa0is greater than\xa0",(0,r.kt)("inlineCode",{parentName:"li"},"Number"),"\xa0."),(0,r.kt)("li",{parentName:"ul"},"Remove rows where\xa0",(0,r.kt)("inlineCode",{parentName:"li"},"fare_amount"),"\xa0is very small (less than\xa0",(0,r.kt)("inlineCode",{parentName:"li"},"Value"),"\xa0for example)."),(0,r.kt)("li",{parentName:"ul"},"Ensure that the latitudes and longitudes are reasonable for the use case."),(0,r.kt)("li",{parentName:"ul"},"Ensure\xa0",(0,r.kt)("inlineCode",{parentName:"li"},"passenger_count"),"\xa0is greater than\xa0",(0,r.kt)("inlineCode",{parentName:"li"},"Number"),"\xa0."),(0,r.kt)("li",{parentName:"ul"},"Be sure to add\xa0",(0,r.kt)("inlineCode",{parentName:"li"},"tolls_amount"),"\xa0and\xa0",(0,r.kt)("inlineCode",{parentName:"li"},"fare_amount"),"\xa0to\xa0",(0,r.kt)("inlineCode",{parentName:"li"},"Fare amount"),"\xa0as the target variable since total_amount includes tips."),(0,r.kt)("li",{parentName:"ul"},"Because the source dataset is large (>1 Billion rows), sample the dataset to less than 1 Million rows."),(0,r.kt)("li",{parentName:"ul"},"Only copy fields that will be used in your model (",(0,r.kt)("inlineCode",{parentName:"li"},"report_prediction_data"),"\xa0is a good guide).")),(0,r.kt)("p",null,"Create a cleaned copy of the data in\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"Table")),(0,r.kt)("h3",{id:"task-2-create-a-bigquery-ml-model"},"Task 2. Create a BigQuery ML model"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Based on the data you have in\xa0",(0,r.kt)("inlineCode",{parentName:"li"},"Table"),"\xa0, build a BigQuery ML model that predicts\xa0",(0,r.kt)("inlineCode",{parentName:"li"},"Fare amount"),"\xa0."),(0,r.kt)("li",{parentName:"ol"},"Call the model\xa0",(0,r.kt)("inlineCode",{parentName:"li"},"Fare"),"\xa0.")),(0,r.kt)("p",null,"Note:\xa0Your model will need an RMSE of 10 or less to complete the task."),(0,r.kt)("p",null,"Some helpful hints:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"You can encapsulate any additional data transformations in a\xa0",(0,r.kt)("a",{parentName:"li",href:"https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-create#transform"},"TRANSFORM()"),"\xa0clause"),(0,r.kt)("li",{parentName:"ul"},"Keep in mind, only features in the\xa0",(0,r.kt)("inlineCode",{parentName:"li"},"TRANSFORM()"),"\xa0clause will be passed to the model. You can use a\xa0",(0,r.kt)("inlineCode",{parentName:"li"},"* EXCEPT(feature_to_leave_out)"),"\xa0to pass some or all of the features without explicitly calling them"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ST_distance()"),"\xa0and\xa0",(0,r.kt)("inlineCode",{parentName:"li"},"ST_GeogPoint()"),"\xa0GIS functions in BigQuery can be used to easily calculate euclidean distance (i.e. how far pickup to dropoff did the taxi travel):")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"ST_Distance(ST_GeogPoint(pickuplon, pickuplat), ST_GeogPoint(dropofflon, dropofflat)) AS euclidean\n")),(0,r.kt)("p",null,"Create BigQuery ML model\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"Fare"),"\xa0with RMSE 10 or less"),(0,r.kt)("h3",{id:"task-3-perform-a-batch-prediction-on-new-data"},"Task 3. Perform a batch prediction on new data"),(0,r.kt)("p",null,"Leadership is curious to see how well your model performs over new data, in this case, all of the data they've collected in 2015. This data is in\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"taxirides.report_prediction_data"),". Only values known at prediction time are included in the table."),(0,r.kt)("p",null,"Use\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"ML.PREDICT"),"\xa0and your model to predict\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"Fare amount"),"\xa0and store your results in a table called\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"2015_fare_amount_predictions"),"."))}p.isMDXComponent=!0}}]);