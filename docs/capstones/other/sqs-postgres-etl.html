<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-capstones/other/sqs-postgres-etl/README">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">Data Engineering Take Home - ETL off a SQS Qeueue | Recohut Data Bootcamp</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://www.recohut.com/docs/capstones/other/sqs-postgres-etl"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="keywords" content="data science, data engineering, data analytics"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Data Engineering Take Home - ETL off a SQS Qeueue | Recohut Data Bootcamp"><meta data-rh="true" name="description" content="This challenge will focus on your ability to write a small application that can read from an AWS SQS Qeueue, transform that data, then write to a Postgres database. Your objective is to read JSON data containing user login behavior from an AWS SQS Queue. Fetch wants to hide personal identifiable information (PII). The fields device_id and ip should be masked, but in a way where it is easy for data analysts to identify duplicate values in those fields. Once you have flattened the JSON data object and masked those two fields, write each record to a Postgres database."><meta data-rh="true" property="og:description" content="This challenge will focus on your ability to write a small application that can read from an AWS SQS Qeueue, transform that data, then write to a Postgres database. Your objective is to read JSON data containing user login behavior from an AWS SQS Queue. Fetch wants to hide personal identifiable information (PII). The fields device_id and ip should be masked, but in a way where it is easy for data analysts to identify duplicate values in those fields. Once you have flattened the JSON data object and masked those two fields, write each record to a Postgres database."><link data-rh="true" rel="icon" href="/img/branding/favicon-black.svg"><link data-rh="true" rel="canonical" href="https://www.recohut.com/docs/capstones/other/sqs-postgres-etl"><link data-rh="true" rel="alternate" href="https://www.recohut.com/docs/capstones/other/sqs-postgres-etl" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.recohut.com/docs/capstones/other/sqs-postgres-etl" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Recohut Data Bootcamp RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Recohut Data Bootcamp Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-B4S1B1ZDTT"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-B4S1B1ZDTT",{})</script><link rel="stylesheet" href="/assets/css/styles.47c7b9d5.css">
<link rel="preload" href="/assets/js/runtime~main.251db5a0.js" as="script">
<link rel="preload" href="/assets/js/main.1462881d.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/branding/favicon-color.svg" alt="Recohut Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/branding/favicon-color.svg" alt="Recohut Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Bootcamp</b></a><a class="navbar__item navbar__link" href="/docs/introduction">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/sparsh-ai/recohut" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div><div class="searchHintContainer_Pkmr"><kbd class="searchHint_iIMx">ctrl</kbd><kbd class="searchHint_iIMx">K</kbd></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><main class="docMainContainer_gTbr docMainContainerEnhanced_Uz_u"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Data Engineering Take Home - ETL off a SQS Qeueue</h1><p>This challenge will focus on your ability to write a small application that can read from an AWS SQS Qeueue, transform that data, then write to a Postgres database. Your objective is to read JSON data containing user login behavior from an AWS SQS Queue. Fetch wants to hide personal identifiable information (PII). The fields device_id and ip should be masked, but in a way where it is easy for data analysts to identify duplicate values in those fields. Once you have flattened the JSON data object and masked those two fields, write each record to a Postgres database. </p><p>The target table&#x27;s DDL is:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">-- Creation of user_logins table</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CREATE TABLE IF NOT EXISTS user_logins(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    user_id             varchar(128),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    device_type         varchar(32),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    masked_ip           varchar(256),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    masked_device_id    varchar(256),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    locale              varchar(32),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    app_version         integer,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    create_date         date</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You will have to make a number of decisions as you develop this solution:</p><ul><li>How will you read messages from the queue?</li><li>What type of data structures should be used?</li><li>How will you mask the PII data so that duplicate values can be identified?</li><li>What will be your strategy for connecting and writing to Postgres?</li><li>Where and how will your application run?</li></ul><p>For this assignment an ounce of communication and organization is worth a pound of execution. Please answer the following questions:</p><ul><li>How would you deploy this application in production?</li><li>What other components would you want to add to make this production ready?</li><li>How can this application scale with a growing data set.</li><li>How can PII be recovered later on?</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="infra-setup">Infra Setup<a class="hash-link" href="#infra-setup" title="Direct link to heading">​</a></h2><p>The following docker compose setup the infra:</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">docker-compose.yml</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;3.9&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">services</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">localstack</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> localstack/localstack</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">0.14.3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">network_mode</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> bridge</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;127.0.0.1:443:443&quot;</span><span class="token plain">              </span><span class="token comment" style="color:#999988;font-style:italic"># only required for Pro (LocalStack HTTPS Edge Proxy)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;127.0.0.1:4510-4559:4510-4559&quot;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># external service port range</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;127.0.0.1:4566:4566&quot;</span><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># LocalStack Edge Proxy</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> DEBUG=$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">DEBUG</span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> LAMBDA_EXECUTOR=$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">LAMBDA_EXECUTOR</span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> HOST_TMP_FOLDER=$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">TMPDIR</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">/tmp/</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">localstack</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> DOCKER_HOST=unix</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">///var/run/docker.sock</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> HOSTNAME_EXTERNAL=localstack</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;${TMPDIR:-/tmp}/localstack:/tmp/localstack&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/var/run/docker.sock:/var/run/docker.sock&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">PWD</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">/data/sample_data.json.gz</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/tmp/data/sample_data.json.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">PWD</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">/scripts/create_and_write_to_queue.py</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/tmp/scripts/create_and_write_to_queue.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">PWD</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">/scripts/transformation.py</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/tmp/scripts/transformation.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">PWD</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">/scripts/01_call_python_scripts.sh</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/docker</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">entrypoint</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">initaws.d/01_call_python_scripts.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">postgres</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> postgres</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> POSTGRES_DB=postgres</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> POSTGRES_USER=postgres</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> POSTGRES_PASSWORD=postgres</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> 5432</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">5432</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">expose</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5432</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">PWD</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">/scripts/create_table.sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/docker</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">entrypoint</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">initdb.d/create_table.sql</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>An AWS SQS Queue is created</li><li>A script is run to write 100 JSON records to the queue</li><li>A Postgres database will be stood up</li><li>A user_logins table will be created in the public schema</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="implementation-steps">Implementation Steps<a class="hash-link" href="#implementation-steps" title="Direct link to heading">​</a></h2><ol><li>Flattened the JSON data file and stored the processed data in a dataframe</li><li>Masked &#x27;device_id&#x27; and &#x27;ip&#x27; columns in such a way where it is easy for data analysts to identify duplicate values in those fields</li><li>The transformed dataframe is then stored in a postgresql table called user_logins using python script</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="implementation-procedure">Implementation Procedure<a class="hash-link" href="#implementation-procedure" title="Direct link to heading">​</a></h2><p>We can read messages from the queue using boto3 client function. This helps us to connect to the AWS account and create a queue and pull the json file. I masked the columns using label encoder. I used this method because this is an excellent way to also identify duplicate values from the masked the data. The unmasking process is also easy, just use inverse_transform function at the receiver side and the data is decrypted back to its original form.
The application will run on the AWS server since the SQS data queue is hosted on AWS.
The transformed data is stored in a postgresql table. PostgreSql server is hosted on Docker desktop. All the connection details were taken from there. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="future-scope">Future scope<a class="hash-link" href="#future-scope" title="Direct link to heading">​</a></h2><ol><li>How would you deploy this application in production?</li></ol><p>--&gt; While deploying the application in production one should endure that the database is configured. Security is configured to avoid data breach issues. The application should be pushed to a package.</p><p>2) What other components would you want to add to make this production ready?</p><p>--&gt; We can do automation testing on the application to ensure that the application is robust enough and does not break down more often. We can also add a user friendly website or dashboard where he/she can start and stop the entire ETL process or we can automate the entire process to run at regular intervals (daily/weekly,etc.) and the user can just invade in the process when there is an error in the process.
There should also be a CI framework where new code can be integrated easily without much changes and user can also keep a track of the commit changes done to the framework. </p><p>3) How can this application scale with a growing data set.</p><p>--&gt; By using load balancers we can balance out the data. This would help scale the data and also avoid overloading issues when the dataset grows in size. Also, in order to avoid server downtime issues, we can use web proxy servers.</p><p>4) How can PII be recovered later on?</p><p>--&gt; We can recover back the masked data using inverse_tranform function present in sklearn library.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-will-you-read-messages-from-the-queue">How will you read messages from the queue?<a class="hash-link" href="#how-will-you-read-messages-from-the-queue" title="Direct link to heading">​</a></h3><p>To read messages from the queue, I would use the receive_message method of the boto3 library, which is the AWS SDK for Python. This method allows me to specify the URL of the queue and the maximum number of messages to retrieve in a single request.</p><p>I would then use a loop to continually retrieve messages from the queue and process them as needed. After processing a message, I would use the delete_message method to remove it from the queue. This would ensure that the message is only processed once and that it does not clog up the queue.</p><p>In addition to these basic steps, I would also need to handle error cases such as the queue being empty or the request timing out. I would also need to implement retry logic to handle cases where the message processing fails due to temporary issues or network errors.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="what-type-of-data-structures-should-be-used">What type of data structures should be used?<a class="hash-link" href="#what-type-of-data-structures-should-be-used" title="Direct link to heading">​</a></h3><p>I will need to use a few different data structures for this project. A queue data structure will be useful for storing the messages that I retrieve from the AWS SQS queue. I will need to parse the JSON data contained in the messages, so I will use a dictionary or object data structure to store the data for each individual record. The data will need to be stored in a database, so I will use a database table data structure to represent the user_logins table in the Postgres database. I may also need to use additional data structures, such as lists or arrays, to store intermediate results or perform calculations on the data as I process it.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-will-you-mask-the-pii-data-so-that-duplicate-values-can-be-identified">How will you mask the PII data so that duplicate values can be identified?<a class="hash-link" href="#how-will-you-mask-the-pii-data-so-that-duplicate-values-can-be-identified" title="Direct link to heading">​</a></h3><p>In this code, the PII data is masked by encoding the ip and device_id fields using base64 encoding. This process converts the plaintext values of these fields into a series of ASCII characters, which can then be represented as a series of base64 characters.</p><p>The base64 encoding is done using the base64_encode function, which takes in a plain string as input and returns the base64 encoded version of that string. The ip and device_id fields are passed through this function and the resulting encoded strings are then stored back in the message_body dictionary, replacing the original values of these fields.</p><p>This method of masking allows data analysts to easily identify duplicate values in the ip and device_id fields, because even if two records have the same original values for these fields, they will have different encoded values. This means that analysts can still distinguish between different records and identify duplicates, even though the original PII data is not visible.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="what-will-be-your-strategy-for-connecting-and-writing-to-postgres">What will be your strategy for connecting and writing to Postgres?<a class="hash-link" href="#what-will-be-your-strategy-for-connecting-and-writing-to-postgres" title="Direct link to heading">​</a></h3><p>To connect to and write to Postgres, you can use a library such as psycopg2. This library provides a Python interface to PostgreSQL, allowing you to connect to a PostgreSQL database, create cursors for executing SQL queries, and commit transactions.</p><p>To use psycopg2, you will first need to install it using pip. Once you have psycopg2 installed, you can use it to connect to a PostgreSQL database by creating a connection object. For example:</p><div class="language-py codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-py codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> psycopg2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Connect to PostgreSQL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">postgres_conn </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> psycopg2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">connect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    host </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;localhost&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    database </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;postgres&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    user </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;postgres&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    password </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;postgres&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This will create a connection to a PostgreSQL database running on localhost, using the postgres database and the postgres user with the password postgres.</p><p>To execute SQL queries and write data to the database, you can create a cursor object using the connection object. You can then use the cursor to execute SQL queries and commit the results to the database. Once you are finished writing to the database, you should close the cursor and the connection to the database to release any resources being used.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="where-and-how-will-your-application-run">Where and how will your application run?<a class="hash-link" href="#where-and-how-will-your-application-run" title="Direct link to heading">​</a></h3><p>My application will run as a standalone script that can be executed from the command line. It will connect to the AWS SQS queue running on localhost, read the JSON data from the queue, mask the device_id and ip fields, and write the transformed data to the Postgres database running on localhost. The script can be run manually at any time by the user, or it can be set up to run on a schedule using a cron job or similar scheduling tool.</p><p>To run the script, the user will need to have the necessary dependencies installed, including python3, pip3, awslocal, docker, and docker-compose. The user will also need to start the localstack and Postgres docker containers using the provided docker-compose file. Once the containers are running, the user can execute the script using the appropriate command line arguments, such as the host and port for the SQS queue and the Postgres database. The script will then read from the SQS queue, transform the data, and write the transformed data to the Postgres database until all messages in the queue have been processed. Once the script has completed, the user can stop the docker containers and optionally clean up the docker resources using the provided make commands.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-would-you-deploy-this-application-in-production">How would you deploy this application in production?<a class="hash-link" href="#how-would-you-deploy-this-application-in-production" title="Direct link to heading">​</a></h3><p>There are several ways to deploy this application in production, and the specific approach will depend on the requirements and constraints of the production environment. Below are some potential options for deploying the application:</p><p>Run the script as a standalone application on a dedicated server or virtual machine (VM). This would require installing the necessary dependencies (python3, boto3, psycopg2, AWS CLI) on the server, setting up the production Postgres database, and configuring the script to connect to the appropriate SQS queue and Postgres database. The script could be scheduled to run periodically using a cron job or similar scheduling tool.</p><p>Use a containerization platform such as Docker to package the application and its dependencies into a container image, and then run the container in a production environment. This would allow for easier deployment and scaling of the application, as well as consistent execution environments across different servers or VMs.</p><p>Use a serverless platform such as AWS Lambda to execute the application in response to specific events, such as messages being added to the SQS queue. This would eliminate the need to manage infrastructure and scale the application manually, as the serverless platform would handle these tasks automatically.</p><p>Regardless of the chosen deployment approach, it would be important to ensure that the production environment is secure and that the application is able to handle any errors or exceptions that may occur during execution. It may also be necessary to implement logging and monitoring to track the performance and health of the application.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="what-other-components-would-you-want-to-add-to-make-this-production-ready">What other components would you want to add to make this production ready?<a class="hash-link" href="#what-other-components-would-you-want-to-add-to-make-this-production-ready" title="Direct link to heading">​</a></h3><p>To make this application production-ready, I would recommend adding the following components:</p><p>Error handling: Add try-except blocks and/or error logging to handle exceptions that may occur during execution and ensure that the application does not crash.</p><p>Monitoring and alerting: Implement monitoring and alerting to track the performance and health of the application, and receive notifications if issues arise.</p><p>Security: Implement security measures such as encryption of sensitive data, secure connections to databases and other external resources, and access controls to prevent unauthorized access to the application and data.</p><p>Scalability: Add mechanisms to scale the application up or down based on workload, such as using a container orchestration platform or serverless functions.</p><p>Disaster recovery: Implement disaster recovery measures to ensure that the application can recover from failures or outages, such as backing up data and having a plan in place to restore the application in the event of a disaster.</p><p>Testing: Perform testing of the application to ensure that it is functioning correctly and meets the required specifications. This may include unit tests, integration tests, and end-to-end tests.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-can-this-application-scale-with-a-growing-data-set">How can this application scale with a growing data set?<a class="hash-link" href="#how-can-this-application-scale-with-a-growing-data-set" title="Direct link to heading">​</a></h3><p>There are several ways to scale this application to handle a growing data set:</p><p>Use a load balancer: Set up a load balancer to distribute incoming requests across multiple instances of the application, allowing the application to scale horizontally as the workload increases.</p><p>Use a distributed database: If the Postgres database becomes a bottleneck, consider using a distributed database system that can scale horizontally across multiple servers. This would allow the application to continue writing data to the database as the data set grows.</p><p>Use a serverless platform: Consider using a serverless platform such as AWS Lambda to execute the application in response to specific events, such as messages being added to the SQS queue. This would allow the application to scale automatically based on workload, without the need to manually provision and configure additional servers or VMs.</p><p>Use a queue-based architecture: Implement a queue-based architecture, where the application writes data to a queue instead of directly to the database. This would allow the application to scale independently of the database and decouple the data ingestion and processing stages, allowing them to scale separately.</p><p>Use a distributed cache: Consider using a distributed cache, such as Redis, to store frequently accessed data in memory, reducing the load on the database and improving the performance of the application.</p><p>Use a data lake: If the data set becomes too large to process in real-time, consider storing the data in a data lake and using batch processing or stream processing to analyze the data as needed. This would allow the application to scale to very large data sets by offloading the data</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-can-pii-be-recovered-later-on">How can PII be recovered later on?<a class="hash-link" href="#how-can-pii-be-recovered-later-on" title="Direct link to heading">​</a></h3><p>Personal identifiable information (PII) can be recovered later on by reversing the process used to mask the PII data. For example, if the PII data was encoded using base64 encoding, it can be recovered by decoding the base64-encoded data back to its original form.</p><p>It is important to note that PII data should be treated with caution and handled in accordance with relevant laws and regulations, as well as any applicable privacy policies. If PII data is masked or encoded for security or privacy reasons, it may be necessary to have a secure process in place for accessing the original data when needed, such as requiring authentication and authorization from authorized personnel. It may also be necessary to have a secure and auditable process for storing and handling the original PII data to ensure that it is not accessed or modified by unauthorized individuals.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2023-04-09T13:34:30.000Z">Apr 9, 2023</time></b> by <b>sparsh</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#infra-setup" class="table-of-contents__link toc-highlight">Infra Setup</a></li><li><a href="#implementation-steps" class="table-of-contents__link toc-highlight">Implementation Steps</a></li><li><a href="#implementation-procedure" class="table-of-contents__link toc-highlight">Implementation Procedure</a></li><li><a href="#future-scope" class="table-of-contents__link toc-highlight">Future scope</a><ul><li><a href="#how-will-you-read-messages-from-the-queue" class="table-of-contents__link toc-highlight">How will you read messages from the queue?</a></li><li><a href="#what-type-of-data-structures-should-be-used" class="table-of-contents__link toc-highlight">What type of data structures should be used?</a></li><li><a href="#how-will-you-mask-the-pii-data-so-that-duplicate-values-can-be-identified" class="table-of-contents__link toc-highlight">How will you mask the PII data so that duplicate values can be identified?</a></li><li><a href="#what-will-be-your-strategy-for-connecting-and-writing-to-postgres" class="table-of-contents__link toc-highlight">What will be your strategy for connecting and writing to Postgres?</a></li><li><a href="#where-and-how-will-your-application-run" class="table-of-contents__link toc-highlight">Where and how will your application run?</a></li><li><a href="#how-would-you-deploy-this-application-in-production" class="table-of-contents__link toc-highlight">How would you deploy this application in production?</a></li><li><a href="#what-other-components-would-you-want-to-add-to-make-this-production-ready" class="table-of-contents__link toc-highlight">What other components would you want to add to make this production ready?</a></li><li><a href="#how-can-this-application-scale-with-a-growing-data-set" class="table-of-contents__link toc-highlight">How can this application scale with a growing data set?</a></li><li><a href="#how-can-pii-be-recovered-later-on" class="table-of-contents__link toc-highlight">How can PII be recovered later on?</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Bootcamp. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.251db5a0.js"></script>
<script src="/assets/js/main.1462881d.js"></script>
</body>
</html>