<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-capstones/other/data-ingestion-pulumi-lambda-snowflake/README">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">paas-data-ingestion | Recohut Data Bootcamp</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://www.recohut.com/docs/capstones/other/data-ingestion-pulumi-lambda-snowflake"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="keywords" content="data science, data engineering, data analytics"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="paas-data-ingestion | Recohut Data Bootcamp"><meta data-rh="true" name="description" content="Ingest and prepare data with AWS lambdas, Snowflake and dbt in a scalable, fully replayable manner."><meta data-rh="true" property="og:description" content="Ingest and prepare data with AWS lambdas, Snowflake and dbt in a scalable, fully replayable manner."><link data-rh="true" rel="icon" href="/img/branding/favicon-black.svg"><link data-rh="true" rel="canonical" href="https://www.recohut.com/docs/capstones/other/data-ingestion-pulumi-lambda-snowflake"><link data-rh="true" rel="alternate" href="https://www.recohut.com/docs/capstones/other/data-ingestion-pulumi-lambda-snowflake" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.recohut.com/docs/capstones/other/data-ingestion-pulumi-lambda-snowflake" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Recohut Data Bootcamp RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Recohut Data Bootcamp Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-B4S1B1ZDTT"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-B4S1B1ZDTT",{})</script><link rel="stylesheet" href="/assets/css/styles.e4e34528.css">
<link rel="preload" href="/assets/js/runtime~main.166317d0.js" as="script">
<link rel="preload" href="/assets/js/main.3580ce8c.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/branding/favicon-color.svg" alt="Recohut Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/branding/favicon-color.svg" alt="Recohut Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Bootcamp</b></a><a class="navbar__item navbar__link" href="/docs/bootcamp">Docs</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/sparsh-ai/recohut" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div><div class="searchHintContainer_Pkmr"><kbd class="searchHint_iIMx">ctrl</kbd><kbd class="searchHint_iIMx">K</kbd></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/bootcamp">Recohut Data Bootcamps</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/foundations/developer-foundations/install-anaconda">foundations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/storage/apache-couchdb">storage</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/processing/apache-beam">processing</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/data-modeling/3nf-data-modeling">data-modeling</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/extraction">Data Extraction</a><button aria-label="Toggle the collapsible sidebar category &#x27;Data Extraction&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/orchestration">Orchestration</a><button aria-label="Toggle the collapsible sidebar category &#x27;Orchestration&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/devops">DevOps</a><button aria-label="Toggle the collapsible sidebar category &#x27;DevOps&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/visualization">Visualization</a><button aria-label="Toggle the collapsible sidebar category &#x27;Visualization&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/datascience/algorithms/decision-trees">datascience</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/assignments">Assignments</a><button aria-label="Toggle the collapsible sidebar category &#x27;Assignments&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/capstones">Capstones</a><button aria-label="Toggle the collapsible sidebar category &#x27;Capstones&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/capstones/ServerlessStreamingApp">Serverless Streaming Data on AWS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/capstones/acled">ACLED</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/capstones/citibike-trip-histories">Citi Bike Trip Histories</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/capstones/city-pollution">Air Pollution Pipeline</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/capstones/city-traffic-drone">Airflow - City Traffic Drone</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/capstones/climate">Global Historical Climatology Network Daily Data Pipeline</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/capstones/cloudmaze">Building End to end data pipeline in AWS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/capstones/dbt-redshift">README</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/capstones/digitalskola">DigitalSkola</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/capstones/disaster-response">Disaster Response Pipeline</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/capstones/funflix">Funflix</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/capstones/hmc">Datalake Schema Correction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/capstones/kinesis-flink-beam">Log Analytics and Processing in Real-Time</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/capstones/kinesis-flink-etl">Streaming ETL pipeline with Apache Flink and Amazon Kinesis Data Analytics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/capstones/kortex">Kortex</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/capstones/lufthansa">Lufthansa API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/capstones/movie-sentiment">Movie Review Sentiment Analysis Pipeline</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/capstones/multi-touch-attribution">Multi-touch Attribution</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/docs/capstones/other/covid19-datalake">other</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/capstones/other/covid19-datalake">Covid-19 Data Pipeline</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/capstones/other/data-ingestion-pulumi-lambda-snowflake">paas-data-ingestion</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/capstones/other/equitize">Equitize Data Migration</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/capstones/other/fireflow">Build an ELT pipeline with NYC Taxi dataset</a><button aria-label="Toggle the collapsible sidebar category &#x27;Build an ELT pipeline with NYC Taxi dataset&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/capstones/other/loop-analytics">Loop Analytics</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/capstones/other/patent-analytics">Patent Analytics Data Pipeline</a><button aria-label="Toggle the collapsible sidebar category &#x27;Patent Analytics Data Pipeline&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/capstones/other/reddit-kafka-sparkstream-bigquery">reddit-data-engineering of r/FedEx</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/capstones/other/resale-price-realtime">Machine Learning Streamming with Kafka, Debezium and BentoML</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/capstones/other/sqs-postgres-etl">Data Engineering Take Home - ETL off a SQS Qeueue</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/capstones/other/star-jeans-etl">ETL Building for an E-commerce Jeans Company</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/capstones/other/taxi-fare-prediction">NYC Taxi Fare Prediction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/capstones/other/text-speech-data-pipeline">Data Pipeline for Text to Speech translation model</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/capstones/other/topic-modeling-pipeline">Machine Learning with Big Data</a><button aria-label="Toggle the collapsible sidebar category &#x27;Machine Learning with Big Data&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/capstones/other/twitter-sentiment-realtime">Twitter Sentiment Realtime</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/capstones/other/twitter-snowpipe">Auto-Ingest Twitter Data into Snowflake</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/capstones/other/us-job-vacancies">Work around the world Job vacancies analysis</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/capstones/other/youtube-insights">YouTube Trend Analysis Workshop</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/capstones/recofront">Building Recommender System from Scratch</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/capstones/reddit">Reddit Submissions, Authors and Subreddits analysis</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/capstones/redshield">AWS Kafka and DynamoDB for real time fraud detection</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/capstones/robust-data-pipeline">Data Pipeline with dbt, Airflow and Great Expectations</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/capstones/smartcity/dataStream">smartcity</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/capstones/sparkify">Sparkify</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/capstones/spotify">Spotify</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/capstones/twitter-sentiment-glue">Twitter data Topic Analysis and Realtime Sentiment Analysis</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/capstones/us-immigration">US Immigration analysis and data pipeline</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/mlops">MLOps</a><button aria-label="Toggle the collapsible sidebar category &#x27;MLOps&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/a1-interviewprep">Interview Preparation</a><button aria-label="Toggle the collapsible sidebar category &#x27;Interview Preparation&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/a3-casestudies">Case Studies</a><button aria-label="Toggle the collapsible sidebar category &#x27;Case Studies&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/b3-misc/explore-further">b3-misc</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/mathematics">Mathematics</a><button aria-label="Toggle the collapsible sidebar category &#x27;Mathematics&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/capstones"><span itemprop="name">Capstones</span></a><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">other</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">paas-data-ingestion</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>paas-data-ingestion</h1><p>Ingest and prepare data with AWS lambdas, Snowflake and dbt in a scalable, fully replayable manner.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a class="hash-link" href="#overview" title="Direct link to heading">​</a></h2><p>This repository contains a fully PaaS infrastructure for data ingestion and transformation at scale. This repository has a companion <a href="https://towardsdatascience.com/the-modern-data-pattern-d34d42216c81" target="_blank" rel="noopener noreferrer">blog post</a>, to which we refer the reader for in-depth analysis of the proposed patterns and the motivations behind the project. While you can enjoy this repository in isolation, please note that our pipeline is part of a bigger architecture, detailed in our <a href="https://towardsdatascience.com/tagged/mlops-without-much-ops" target="_blank" rel="noopener noreferrer">MLOps without Much Ops series</a>.</p><p>The ingestion pipeline mimics a typical data flow for data-driven applications: clients send events, an endpoint collects them and dumps them into a stream, finally a data warehouse stores them for further processing:</p><p><img loading="lazy" src="https://user-images.githubusercontent.com/62965911/224529511-c1ef35b0-1e8a-4bc4-8846-16878c78f6fd.jpg" class="img_ev3q"></p><p>We make use of three main technologies:</p><ul><li><a href="https://www.pulumi.com/" target="_blank" rel="noopener noreferrer">Pulumi</a>, which allows us to manipulate infrastructure-as-code, and to do so in a language we are very familiar with, Python (this is our first project using it coming from Terraform, so any feedback is very welcome!).</li><li><a href="https://signup.snowflake.com/" target="_blank" rel="noopener noreferrer">Snowflake</a>, which allows us to store raw data at scale and manipulate it with powerful SQL queries, abstracting away all the complexity of distributed computing in a simple API.</li><li><a href="https://www.getdbt.com/" target="_blank" rel="noopener noreferrer">dbt</a>, which allows us to define data transformation as versioned, replayable DAGs, and mix-and-match materialization strategies to suite our needs.</li></ul><p>Finally, it is worth mentioning that the repository is e-commerce related as a results of mainly three factors:</p><ul><li>our own experience in building <a href="https://github.com/jacopotagliabue/you-dont-need-a-bigger-boat" target="_blank" rel="noopener noreferrer">pipelines for the industry</a>;</li><li>the availability of high-volume, <a href="https://github.com/coveooss/SIGIR-ecom-data-challenge" target="_blank" rel="noopener noreferrer">high-quality data</a> to simulate a realistic scenario;</li><li>finally, the high bar set by e-commerce as far as data quantity and data-driven applications: due to the nature of the business and the competition, even medium-sized digital shops tend to produce an enormous amount of data, and to run pretty sophisticated ML flows on top it - in other words, something that works for e-commerce is going to reasonably work for many other use cases out of the box, as they are likely less data intensive and less sophisticated ML-wise.</li></ul><p>Our goal was to keep the code realistic enough for the target use cases, but simple enough as to make it easy for everybody to port this stack to a different industry.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a class="hash-link" href="#prerequisites" title="Direct link to heading">​</a></h2><ul><li><em>Dataset</em>: we use the <a href="https://github.com/coveooss/SIGIR-ecom-data-challenge" target="_blank" rel="noopener noreferrer">Coveo Data Challenge dataset</a> as our real-world dataset (if you prefer to use your own data, you can still re-use the <code>pumper.py</code> app if you adapt the format to your input files).</li><li><em>Snowflake account</em>: <a href="https://signup.snowflake.com" target="_blank" rel="noopener noreferrer">sign-up for a 30-day free trial</a>.</li><li><em>Pulumi account</em>: <a href="https://www.pulumi.com" target="_blank" rel="noopener noreferrer">sign-up for a free Individual account</a>.</li><li><em>AWS account</em>: <a href="https://aws.amazon.com/free/" target="_blank" rel="noopener noreferrer">sign-up for a free AWS account</a> (S3, API Gateway &amp; Lambda have a free tier).</li></ul><p>Please note that by running this project you <em>may incur</em> in some cloud costs: make sure to keep costs and infrastructure monitored and to understand how much your experiments are covered by the free tier.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="structure">Structure<a class="hash-link" href="#structure" title="Direct link to heading">​</a></h2><p>The project is divided in three main components and a simulation script.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="infrastructure">Infrastructure<a class="hash-link" href="#infrastructure" title="Direct link to heading">​</a></h3><p>Following the infrastructure-as-code paradigm, the folder contains the Pulumi code necessary to properly set up the AWS (lambda function, API Gateway, Cloudwatch, Firehose, etc.) and Snowflake components needed for the ingestion platform to work. For instructions on how to run it, see below.</p><p><a href="https://github.com/jacopotagliabue/paas-data-ingestion/blob/main/infrastructure/__main__.py" target="_blank" rel="noopener noreferrer">infrastructure/<strong>main</strong>.py</a> checks which services have to be created/updated/removed. The script defines:</p><ul><li><code>s3_logs_bucket</code> is the S3 bucket we use to store the logs sent to Firehose;</li><li><code>sf_database</code> is the database on Snowflake;</li><li><code>sf_warehouse</code> is the Snowflake warehouse;</li><li><code>sf_roles</code> is a custom module to create and manage two roles:<ul><li>a Read-Write <code>*_RW</code> profile (for admins),</li><li>a Read-Only <code>*_RO</code> profile;</li></ul></li><li><code>sf_stream_schema</code> is the schema for RAW logs;</li><li><code>sf_stream_logs_snowpipe</code> is a custom module to configure Snowpipe and the policies required to read the data stored on your bucket;<ul><li><code>self.firehose</code> is the <a href="https://aws.amazon.com/it/kinesis/data-firehose/" target="_blank" rel="noopener noreferrer">Firehose</a> stream where RAW logs are sent by the ingestion endpoint (Lambda Function);</li><li><code>self.table</code> is the final table where RAW logs are stored by Snowpipe;</li><li><code>self.storage_integration</code>, <code>self.stage</code> &amp; <code>self.pipe</code> define the Snowflake resource required to allow Snowpipe to read your data;</li><li><code>aws.s3.BucketNotification</code> notifies Snowpipe every time a new object is stored (by Firehose) on your bucket;</li></ul></li><li><code>api</code> &amp; <code>api_stage</code> define <a href="https://aws.amazon.com/it/api-gateway/" target="_blank" rel="noopener noreferrer">API Gateway</a>, a public entry-point for the Lambda function;</li><li><code>lambda_api_collect</code> is a custom module to define the Lambda function for the <code>/collect</code> endpoint.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="dbt">dbt<a class="hash-link" href="#dbt" title="Direct link to heading">​</a></h3><p>The folder contains a typical dbt project, whose goal is to collect, organize, version all the transformations needed to go from the raw data ingested by the pixel endpoint to the pre-calculated features and aggregations that can be consumed by downstream processes (BI, ML, etc.). For instructions on how to run the dbt project, see below.</p><p>We used dbt to process RAW logs and to normalize the data into 3 different schemes:</p><ul><li><code>EVENTS</code>, stored on <a href="https://github.com/jacopotagliabue/paas-data-ingestion/blob/main/dbt/models/events/marts" target="_blank" rel="noopener noreferrer">dbt/models/events/marts</a>, contains all the materialized tables (<code>events</code>, <code>logs</code>, <code>pageviews</code>, <code>product_actions</code>, <code>purchases</code> &amp; <code>user_agents</code>) with the data computed during the last execution;</li><li><code>EVENTS_LIVE</code>, stored on <a href="https://github.com/jacopotagliabue/paas-data-ingestion/blob/main/dbt/models/events/live" target="_blank" rel="noopener noreferrer">dbt/models/events/live</a>, contains the same tables above (<code>events</code>, <code>logs</code> etc...) updated in real-time; the views are the result of the union of the materialized table and the new events;</li><li><code>STATS</code>, stored on <a href="https://github.com/jacopotagliabue/paas-data-ingestion/blob/main/dbt/models/stats" target="_blank" rel="noopener noreferrer">dbt/models/stats</a>, defines materialized tables (<code>overview_1h</code>, <code>overview_1d</code>) containing all the main pre-calculated stats a dashboard can use (<code>pageviews</code>, <code>add_to_cart</code>, <code>transactions</code>, <code>transaction_revenue</code> etc).</li></ul><p>We define the queries in macros because the tables stored on the <code>EVENTS</code> &amp; <code>EVENTS_LIVE</code> schemes are the same but contain data from different analysis periods. For example, the <code>logs</code> table containing all the sessionized and enriched logs is used as to power the other tables:</p><ul><li><a href="https://github.com/jacopotagliabue/paas-data-ingestion/blob/main/dbt/models/events/marts/logs.sql" target="_blank" rel="noopener noreferrer">dbt/models/events/marts/logs.sql</a> is the materialized version of the table (<code>EVENTS.LOGS</code>); we use an incremental materialization and the SQL query is defined on the <a href="https://github.com/jacopotagliabue/paas-data-ingestion/blob/main/dbt/macros/models/events/select_logs.sql" target="_blank" rel="noopener noreferrer">dbt/macros/models/events/select_logs.sql</a> table;</li><li><a href="https://github.com/jacopotagliabue/paas-data-ingestion/blob/main/dbt/models/events/live/logs_live.sql" target="_blank" rel="noopener noreferrer">dbt/models/events/live/logs_live.sql</a> is the live version of the table (<code>EVENTS_LIVE.LOGS</code>); the script does a UNION between all the events stored on <code>EVENTS.LOGS</code> with all the new events defined on the <code>EVENTS.LOGS_STAGED</code> table (<a href="https://github.com/jacopotagliabue/paas-data-ingestion/blob/main/dbt/models/events/live/logs_staged.sql" target="_blank" rel="noopener noreferrer">dbt/models/events/live/logs_staged.sql</a>)</li></ul><p>Both the <code>EVENTS.LOGS</code> and the <code>EVENTS_LIVE.LOGS_STAGED</code> table uses the same macro <a href="https://github.com/jacopotagliabue/paas-data-ingestion/blob/main/dbt/macros/models/events/select_logs.sql" target="_blank" rel="noopener noreferrer">dbt/macros/models/events/select_logs.sql</a> but with different filters.</p><p>Finally, for pedagogical purposes, we have integrated the <a href="https://github.com/faisalman/ua-parser-js/tree/master/dist" target="_blank" rel="noopener noreferrer">UAParser.js</a> library for parsing the user-agents directly on Snowflake.</p><p>Please see the <em>Bonus</em> section below for a more detailed functional explanation of the overall pattern. As a visual overview, this is the DAG generated by dbt when describing the data transformations we prepared:</p><p><img loading="lazy" src="https://user-images.githubusercontent.com/62965911/224529514-e8fcebd7-dcaa-4484-ae5f-caa85c2949aa.png" class="img_ev3q"></p><p>These screenshots should get you a sense of how the shape of the data changes from the original <a href="https://user-images.githubusercontent.com/62965911/224529516-3607779f-25f1-4410-a66c-5ff7945e7549.png" target="_blank" rel="noopener noreferrer">log table</a> storing the <a href="https://user-images.githubusercontent.com/62965911/224529502-4d129857-834e-4a54-8218-dd3ad5f308ce.png" target="_blank" rel="noopener noreferrer">JSON event</a> from the endpoint, to the final <a href="https://user-images.githubusercontent.com/62965911/224529507-9c7fa0c4-623a-40c8-9981-08dd9f4bee41.png" target="_blank" rel="noopener noreferrer">aggregations</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="aws-lambda">AWS lambda<a class="hash-link" href="#aws-lambda" title="Direct link to heading">​</a></h3><p>A simple AWS lambda function implementing a <a href="https://medium.com/tooso/serving-1x1-pixels-from-aws-lambda-endpoints-9eff73fe7631" target="_blank" rel="noopener noreferrer">data collection pixel</a>. Once deployed, the resulting <code>/collect</code> endpoint will accept <code>POST</code> requests from clients sending e-commerce data: the function is kept simple for pedagogical reason - after accepting the body, it prepares a simple but structured event, and uses another AWS PaaS service, Firehose, to dump it in a stream for downstream storage and further processing.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="data-pumper">Data pumper<a class="hash-link" href="#data-pumper" title="Direct link to heading">​</a></h3><p>To simulate a constant stream of events reaching the collect endpoint, we provide a script that can be run at will to upload e-commerce events in the <a href="https://developers.google.com/analytics/devguides/collection/protocol/v1/parameters" target="_blank" rel="noopener noreferrer">Google Analytics</a> format.</p><p>The events are based on the real-world clickstream dataset open sourced in 2021, the <a href="https://github.com/coveooss/SIGIR-ecom-data-challenge" target="_blank" rel="noopener noreferrer">Coveo Data Challenge</a> dataset. By using real-world anonymized events we provide practitioners with a realistic, non-toy scenario to get acquainted with the design patterns we propose. Please cite our work, share / star the repo if you find the dataset useful!</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-run-it">How to run it<a class="hash-link" href="#how-to-run-it" title="Direct link to heading">​</a></h2><p>Running the stack involves running three operations:</p><ul><li>setting up the infrastructure;</li><li>send data;</li><li>run dbt transformations.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="setting-up-the-infrastructure">Setting up the infrastructure<a class="hash-link" href="#setting-up-the-infrastructure" title="Direct link to heading">​</a></h3><ol><li><a href="https://www.pulumi.com/docs/get-started/install/" target="_blank" rel="noopener noreferrer">Install Pulumi</a> on your computer and configure your <a href="https://www.pulumi.com/docs/reference/cli/pulumi_login/" target="_blank" rel="noopener noreferrer">Pulumi account</a>:<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pulumi login</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li>Jump into the project folder &amp; setup the python venv<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd infrastructure</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">make install</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li>Create a new Pulumi Stack:<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pulumi stack init dev</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li>Configure the new stack with all the required credentials:<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># AWS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pulumi config set aws:region &lt;value&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pulumi config set aws:accessKey &lt;value&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pulumi config set aws:secretKey &lt;value&gt; --secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Snowflake</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pulumi config set snowflake:region &lt;value&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pulumi config set snowflake:account &lt;value&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pulumi config set snowflake:password &lt;value&gt; --secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pulumi config set snowflake:username &lt;value&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>All the configurations will be stored on the <code>Pulumi.dev.yaml</code> file.</li><li>Deploy the stack:<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">make up</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><p>Notes:</p><ul><li>Make sure to use the <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/getting-started_create-admin-group.html" target="_blank" rel="noopener noreferrer">AWS credentiales with Administrator permissions</a>;</li><li>Use the same region for AWS and Snowflake (e.g. <code>us-east-1</code>);</li><li>Follow <a href="https://docs.snowflake.com/en/user-guide/admin-account-identifier.html" target="_blank" rel="noopener noreferrer">this guide</a> to identify your Snowflake account &amp; region name.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="send-data-with-the-pumper">Send data with the pumper<a class="hash-link" href="#send-data-with-the-pumper" title="Direct link to heading">​</a></h3><ul><li>To pump data into the newly created stack, <code>cd</code> into the <a href="https://github.com/jacopotagliabue/paas-data-ingestion/blob/main/utils/pumper" target="_blank" rel="noopener noreferrer">utils/pumper</a> folder, and run <code>make install</code>.</li><li>Download and unzip the <a href="https://github.com/coveooss/SIGIR-ecom-data-challenge" target="_blank" rel="noopener noreferrer">Coveo Data Challenge dataset</a> into <code>utils/pumper/dataset</code>. Make sure the target folder directly contains the <code>.csv</code> files, without additional nesting.</li><li>Create a copy of <code>.env.local</code> named <code>.env</code>, and use the dataset path as the value for <code>DATA_FOLDER</code>, the AWS url for the lambda function for <code>COLLECT_URL</code>.</li><li>Run <code>make pump</code> to start sending Google Analytics events to the endpoint. The script will run until <code>N_EVENTS</code> has been sent (change the variable in your <code>.env</code> file to what you like).</li></ul><p>At every run, <a href="https://github.com/jacopotagliabue/paas-data-ingestion/blob/main/utils/pumper/pumper.py" target="_blank" rel="noopener noreferrer">pumper.py</a> will send events as they are happening in that very moments: so running the code two times will not produce duplicate events, but events with similar categorical features and different id, timestamp etc.</p><p>Please note that if you want to jump start the log table by bulk-loading the dataset (or a portion of it) to Snowflake, you can avoid some idle time waiting for events to be sent by using the <a href="https://docs.snowflake.com/en/sql-reference/sql/copy-into-table.html" target="_blank" rel="noopener noreferrer">copy into</a> function over the raw csv.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="run-dbt-transformations">Run dbt transformations<a class="hash-link" href="#run-dbt-transformations" title="Direct link to heading">​</a></h3><ol><li><p>Jump into the project folder &amp; setup the python venv</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd dbt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">make install</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Configure your dbt profile following the <a href="https://docs.getdbt.com/dbt-cli/configure-your-profile" target="_blank" rel="noopener noreferrer">official guide</a>:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">paas-data-ingestion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">target</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> dev</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">outputs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">dev</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> snowflake</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">account</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> &lt;value</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">user</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> &lt;value</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">password</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> &lt;value</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">role</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ACCOUNTADMIN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">database</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;PAAS_DATA_INGESTION_DEV&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">warehouse</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;PAAS_DATA_INGESTION_DEV_WH&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">schema</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> RAW</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">threads</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">client_session_keep_alive</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">False</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Launch DBT:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">make dbt-run</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">make dbt-rest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">make dbt-docs</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="bonus-mix-and-match-materialization-options">Bonus: mix and match materialization options<a class="hash-link" href="#bonus-mix-and-match-materialization-options" title="Direct link to heading">​</a></h2><p>A basic computation in almost any analytics platform is the &quot;sessionization&quot; of clickstream data ingested from the app. That is the post hoc grouping (<em>inside the data warehouse</em>) of the uninterrupted stream of events into &quot;sessions&quot;, which conventionally are defined with a 30 minutes threshold (i.e. given a user, two events 29 minutes apart are in the same session, if 31 minutes have passed, we now have two sessions):</p><p><img loading="lazy" src="https://user-images.githubusercontent.com/62965911/224529517-0b430e84-6ffc-4ba6-aba5-d340300026dc.jpg" class="img_ev3q"></p><p>Sessionization requires some heavy lifting with window functions, so we would like to run that computation in batch without much latency constraints every X hours; on the other hand, it would be nice if recent events (e.g. session counts) could still be actionable in the stack. The stylized flow below shows how the tables in the repo can be used to solve the problem within a single stack:</p><p><img loading="lazy" src="https://user-images.githubusercontent.com/62965911/224529519-e675cc91-1784-4242-8f54-20456bc29187.jpg" class="img_ev3q"></p><p>Please refer to our <a href="https://towardsdatascience.com/the-modern-data-pattern-d34d42216c81" target="_blank" rel="noopener noreferrer">blog post</a> for more details.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="contributors">Contributors<a class="hash-link" href="#contributors" title="Direct link to heading">​</a></h2><p>This project has been brought to you with love by:</p><ul><li><a href="https://www.linkedin.com/in/bigluck/" target="_blank" rel="noopener noreferrer">Luca Bigon</a>: design, infrastructure, SQL-ing</li><li><a href="https://www.linkedin.com/in/jacopotagliabue/" target="_blank" rel="noopener noreferrer">Jacopo Tagliabue</a>: design, data</li></ul><p>A lot of people helped with the <a href="https://towardsdatascience.com/the-modern-data-pattern-d34d42216c81" target="_blank" rel="noopener noreferrer">blog post</a>: please refer to our article for more details.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="license">License<a class="hash-link" href="#license" title="Direct link to heading">​</a></h2><p>The code is provided &quot;as is&quot; and released under an open MIT License.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2023-04-09T13:34:30.000Z">Apr 9, 2023</time></b> by <b>sparsh</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/capstones/other/covid19-datalake"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Covid-19 Data Pipeline</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/capstones/other/equitize"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Equitize Data Migration</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#structure" class="table-of-contents__link toc-highlight">Structure</a><ul><li><a href="#infrastructure" class="table-of-contents__link toc-highlight">Infrastructure</a></li><li><a href="#dbt" class="table-of-contents__link toc-highlight">dbt</a></li><li><a href="#aws-lambda" class="table-of-contents__link toc-highlight">AWS lambda</a></li><li><a href="#data-pumper" class="table-of-contents__link toc-highlight">Data pumper</a></li></ul></li><li><a href="#how-to-run-it" class="table-of-contents__link toc-highlight">How to run it</a><ul><li><a href="#setting-up-the-infrastructure" class="table-of-contents__link toc-highlight">Setting up the infrastructure</a></li><li><a href="#send-data-with-the-pumper" class="table-of-contents__link toc-highlight">Send data with the pumper</a></li><li><a href="#run-dbt-transformations" class="table-of-contents__link toc-highlight">Run dbt transformations</a></li></ul></li><li><a href="#bonus-mix-and-match-materialization-options" class="table-of-contents__link toc-highlight">Bonus: mix and match materialization options</a></li><li><a href="#contributors" class="table-of-contents__link toc-highlight">Contributors</a></li><li><a href="#license" class="table-of-contents__link toc-highlight">License</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Bootcamp. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.166317d0.js"></script>
<script src="/assets/js/main.3580ce8c.js"></script>
</body>
</html>