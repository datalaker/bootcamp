<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-storage/lab-bigquery-nyctaxi/README">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">GCP BigQuery NYC Taxi | Recohut Data Bootcamp</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://www.recohut.com/docs/storage/lab-bigquery-nyctaxi"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="keywords" content="data science, data engineering, data analytics"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="GCP BigQuery NYC Taxi | Recohut Data Bootcamp"><meta data-rh="true" name="description" content="Objective"><meta data-rh="true" property="og:description" content="Objective"><link data-rh="true" rel="icon" href="/img/branding/favicon-black.svg"><link data-rh="true" rel="canonical" href="https://www.recohut.com/docs/storage/lab-bigquery-nyctaxi"><link data-rh="true" rel="alternate" href="https://www.recohut.com/docs/storage/lab-bigquery-nyctaxi" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.recohut.com/docs/storage/lab-bigquery-nyctaxi" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Recohut Data Bootcamp RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Recohut Data Bootcamp Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-B4S1B1ZDTT"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-B4S1B1ZDTT",{})</script><link rel="stylesheet" href="/assets/css/styles.099cbecb.css">
<link rel="preload" href="/assets/js/runtime~main.40c54d56.js" as="script">
<link rel="preload" href="/assets/js/main.dbd2f5fe.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/branding/favicon-color.svg" alt="Recohut Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/branding/favicon-color.svg" alt="Recohut Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Bootcamp</b></a><a class="navbar__item navbar__link" href="/docs/introduction">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/sparsh-ai/recohut" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div><div class="searchHintContainer_Pkmr"><kbd class="searchHint_iIMx">ctrl</kbd><kbd class="searchHint_iIMx">K</kbd></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><main class="docMainContainer_gTbr docMainContainerEnhanced_Uz_u"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>GCP BigQuery NYC Taxi</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="objective">Objective<a class="hash-link" href="#objective" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="challenge-scenario">Challenge scenario<a class="hash-link" href="#challenge-scenario" title="Direct link to heading">​</a></h3><p>You have started a new role as a Data Engineer for TaxiCab Inc. You are expected to import some historical data to a working BigQuery dataset, and build a basic model that predicts fares based on information available when a new ride starts. Leadership is interested in building an app and estimating for users how much a ride will cost. The source data will be provided in your project.</p><p>You are expected to have the skills and knowledge for these tasks, so don&#x27;t expect step-by-step guides to be provided.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="your-challenge">Your challenge<a class="hash-link" href="#your-challenge" title="Direct link to heading">​</a></h3><p>As soon as you sit down at your desk and open your new laptop you receive your first assignment: build a basic BQML fare prediction model for leadership. Perform the following tasks to import and clean the data, then build the model and perform batch predictions with new data so that leadership can review model performance and make a go/no-go decision on deploying the app functionality.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="task-1-clean-your-training-data">Task 1. Clean your training data<a class="hash-link" href="#task-1-clean-your-training-data" title="Direct link to heading">​</a></h3><p>You&#x27;ve already completed the first step, and have created a dataset <code>taxirides</code> and imported the historical data to table, <code>historical_taxi_rides_raw</code>. This is data prior for rides to 2015.</p><p>Note: You may need to wait 1-3 minutes for the data to be fully populated in your project.</p><p>To complete this task you will need to:</p><ul><li>Clean the data in <code>historical_taxi_rides_raw</code> and make a copy to <code>Table</code> in the same dataset. You can use BigQuery, DataPrep, DataFlow, etc. to create this table and clean the data. Make sure your target column is called <code>Fare amount</code> .</li></ul><p>Some helpful hints:</p><ul><li>You can see the source dataset in the BQ UI - familiarize yourself with the source schema first.</li><li>As a hint for the data available at prediction time, familiarize yourself with the table <code>taxirides.report_prediction_data</code> which shows the format data will arrive at prediction time.</li></ul><p>Data cleaning tasks:</p><ul><li>Ensure <code>trip_distance</code> is greater than <code>Number</code> .</li><li>Remove rows where <code>fare_amount</code> is very small (less than <code>Value</code> for example).</li><li>Ensure that the latitudes and longitudes are reasonable for the use case.</li><li>Ensure <code>passenger_count</code> is greater than <code>Number</code> .</li><li>Be sure to add <code>tolls_amount</code> and <code>fare_amount</code> to <code>Fare amount</code> as the target variable since total_amount includes tips.</li><li>Because the source dataset is large (&gt;1 Billion rows), sample the dataset to less than 1 Million rows.</li><li>Only copy fields that will be used in your model (<code>report_prediction_data</code> is a good guide).</li></ul><p>Create a cleaned copy of the data in <code>Table</code></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="task-2-create-a-bigquery-ml-model">Task 2. Create a BigQuery ML model<a class="hash-link" href="#task-2-create-a-bigquery-ml-model" title="Direct link to heading">​</a></h3><ol><li>Based on the data you have in <code>Table</code> , build a BigQuery ML model that predicts <code>Fare amount</code> .</li><li>Call the model <code>Fare</code> .</li></ol><p>Note: Your model will need an RMSE of 10 or less to complete the task.</p><p>Some helpful hints:</p><ul><li>You can encapsulate any additional data transformations in a <a href="https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-create#transform" target="_blank" rel="noopener noreferrer">TRANSFORM()</a> clause</li><li>Keep in mind, only features in the <code>TRANSFORM()</code> clause will be passed to the model. You can use a <code>* EXCEPT(feature_to_leave_out)</code> to pass some or all of the features without explicitly calling them</li><li><code>ST_distance()</code> and <code>ST_GeogPoint()</code> GIS functions in BigQuery can be used to easily calculate euclidean distance (i.e. how far pickup to dropoff did the taxi travel):</li></ul><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ST_Distance</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ST_GeogPoint</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pickuplon</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pickuplat</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ST_GeogPoint</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dropofflon</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dropofflat</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"> euclidean</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Create BigQuery ML model <code>Fare</code> with RMSE 10 or less</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="task-3-perform-a-batch-prediction-on-new-data">Task 3. Perform a batch prediction on new data<a class="hash-link" href="#task-3-perform-a-batch-prediction-on-new-data" title="Direct link to heading">​</a></h3><p>Leadership is curious to see how well your model performs over new data, in this case, all of the data they&#x27;ve collected in 2015. This data is in <code>taxirides.report_prediction_data</code>. Only values known at prediction time are included in the table.</p><p>Use <code>ML.PREDICT</code> and your model to predict <code>Fare amount</code> and store your results in a table called <code>2015_fare_amount_predictions</code>.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2023-04-09T13:34:30.000Z">Apr 9, 2023</time></b> by <b>sparsh</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#objective" class="table-of-contents__link toc-highlight">Objective</a><ul><li><a href="#challenge-scenario" class="table-of-contents__link toc-highlight">Challenge scenario</a></li><li><a href="#your-challenge" class="table-of-contents__link toc-highlight">Your challenge</a></li><li><a href="#task-1-clean-your-training-data" class="table-of-contents__link toc-highlight">Task 1. Clean your training data</a></li><li><a href="#task-2-create-a-bigquery-ml-model" class="table-of-contents__link toc-highlight">Task 2. Create a BigQuery ML model</a></li><li><a href="#task-3-perform-a-batch-prediction-on-new-data" class="table-of-contents__link toc-highlight">Task 3. Perform a batch prediction on new data</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Bootcamp. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.40c54d56.js"></script>
<script src="/assets/js/main.dbd2f5fe.js"></script>
</body>
</html>